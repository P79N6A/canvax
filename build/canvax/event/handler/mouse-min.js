define("canvax/event/handler/mouse",["canvax/core/Base","canvax/display/Point","canvax/event/CanvaxEvent"],function(a,b,c){var d=function(){};return d.prototype={init:function(){var b=0,c=this,d=this.canvax;_.each(["click","mousedown","mousemove","mouseup","mouseout"],function(e){a.addEvent(d.el,e,function(a){if(d.updateRootOffset(),"mousemove"==a.type){if(1>b)return void b++;b=0}c.__mouseHandler(a)})})},__mouseHandler:function(a){var c=this,d=c.canvax;c.curPoints=[new b((a.pageX||a.clientX)-d.rootOffset.left,(a.pageY||a.clientY)-d.rootOffset.top)];var e=c.curPoints[0],f=c.curPointsTarget[0];if("mousedown"==a.type){if(!f){var g=d.getObjectsUnderPoint(e,1)[0];g&&(c.curPointsTarget=[g])}f=c.curPointsTarget[0],f&&f.dragEnabled&&(c._touching=!0)}var h=document.compareDocumentPosition?function(a,b){return b?!!(16&a.compareDocumentPosition(b)):!1}:function(a,b){return b?b!==b&&(a.contains?a.contains(b):!0):!1};if(("mouseup"==a.type||"mouseout"==a.type&&!h(d.el,a.toElement||a.relatedTarget))&&(1==c._draging&&c._dragEnd(a,f,0),c._draging=!1,c._touching=!1),"mouseout"==a.type)h(d.el,a.toElement||a.relatedTarget)||c.__getcurPointsTarget(a,e);else if("mousemove"==a.type)c._touching&&"mousemove"==a.type&&f?(c._draging?c._dragHander(a,f,0):(f.dragBegin&&f.dragBegin(a),f.context.visible=!1,c._clone2hoverStage(f,0)),c._draging=!0):c.__getcurPointsTarget(a,e);else{var i=f;i||(i=d),c.__dispatchEventInChilds(a,[i])}d.preventDefault&&(a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1)},__getcurPointsTarget:function(b,d){var e=this,f=e.canvax,g=e.curPointsTarget[0],b=a.copyEvent(new c,b);if("mousemove"==b.type&&g&&g._hoverClass&&g.getChildInPoint(d))return b.target=b.currentTarget=g,b.point=g.globalToLocal(d),void e._mouseEventDispatch(g,b);var h=f.getObjectsUnderPoint(d,1)[0];if(g&&g!=h||"mouseout"==b.type){if(!g)return;e.curPointsTarget[0]=null,b.type="mouseout",b.toTarget=h,b.target=b.currentTarget=g,b.point=g.globalToLocal(d),g.context.visible||(g.context.visible=!0),e._mouseEventDispatch(g,b)}h&&g!=h&&(e.curPointsTarget[0]=h,b.type="mouseover",b.fromTarget=g,b.target=b.currentTarget=h,b.point=h.globalToLocal(d),e._mouseEventDispatch(h,b)),"mousemove"==b.type&&h&&(b.target=b.currentTarget=g,b.point=g.globalToLocal(d),e._mouseEventDispatch(g,b)),e._cursorHander(h,g)},_mouseEventDispatch:function(a,b){a.dispatchEvent(b)},_cursorHander:function(a,b){a||b||this._setCursor("default"),a&&b!=a&&this._setCursor(a.context.cursor)},_setCursor:function(a){this._cursor!=a&&(this.canvax.el.style.cursor=a,this._cursor=a)}},d});
define("canvax/animation/AnimationFrame",[],function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}),window.FlashCanvasOptions={swfPath:"http://g.tbcdn.cn/thx/canvax/1.0.0/canvax/library/flashCanvas/"},define("canvax/core/Base",[document.createElement("canvas").getContext?"":"canvax/library/flashCanvas/flashcanvas","canvax/animation/AnimationFrame","ontouchstart"in window?"canvax/library/hammer":"",window._?"":"canvax/library/underscore"],function(a){var b={};"Boolean Number String Function Array Date RegExp Object Error".replace(/[^, ]+/g,function(a){b["[object "+a+"]"]=a.toLowerCase()});var c={mainFrameRate:60,now:0,getEl:function(a){return _.isString(a)?document.getElementById(a):1==a.nodeType?a:a.length?a[0]:null},getOffset:function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=c.documentElement,f=e.clientTop||d.clientTop||0,g=e.clientLeft||d.clientLeft||0,h=1;if(d.getBoundingClientRect){var i=d.getBoundingClientRect();h=(i.right-i.left)/d.clientWidth}h>1&&(f=0,g=0);var j=b.top/h+(window.pageYOffset||e&&e.scrollTop/h||d.scrollTop/h)-f,k=b.left/h+(window.pageXOffset||e&&e.scrollLeft/h||d.scrollLeft/h)-g;return{top:j,left:k}},_pixelCtx:null,__emptyFunc:function(){},_devicePixelRatio:window.devicePixelRatio||1,_createCanvas:function(a,b,c){var d=document.createElement("canvas");return d.style.position="absolute",d.style.width=b+"px",d.style.height=c+"px",d.style.left=0,d.style.top=0,d.setAttribute("width",b*this._devicePixelRatio),d.setAttribute("height",c*this._devicePixelRatio),d.setAttribute("id",a),d},canvasSupport:function(){return!!document.createElement("canvas").getContext},createObject:function(a,b){var d,e=Object.create;return e?d=e(a):(c.__emptyFunc.prototype=a,d=new c.__emptyFunc),d.constructor=b,d},setContextStyle:function(a,b){for(p in b)"textBaseline"!=p&&p in a&&(b[p]||_.isNumber(b[p]))&&("globalAlpha"==p?a[p]*=b[p]:a[p]=b[p])},creatClass:function(a,b,d){if(!b||!a)return a;var e,f=b.prototype;return e=c.createObject(f,a),a.prototype=_.extend(e,a.prototype),a.superclass=c.createObject(f,b),d&&_.extend(e,d),a},debugMode:!1,log:function(){var a=this;if(a.debugMode){if("Error"in window)for(var b in arguments)throw new Error(arguments[b]);else if("console"in window&&console.log)for(var b in arguments)console.log(arguments[b]);return a}},initElement:function(b){a&&a.initElement&&a.initElement(b)},checkOpt:function(a){return a?a&&!a.context?(a.context={},a):a:{context:{}}},_UID:0,getUID:function(){return this._UID++},createId:function(a){var b=a.charCodeAt(a.length-1);return b>=48&&57>=b&&(a+="_"),a+c.getUID()},getType:function(a){return null==a?String(a):"object"==typeof a||"function"==typeof a?b[Object.prototype.toString.call(a)]||"object":typeof a},copy:function(a,b,c){if(_.isEmpty(b))return a;for(var d in b)(!c||a.hasOwnProperty(d)||void 0!==a[d])&&(a[d]=b[d]);return a},copyEvent:function(a,b){for(var c=["type"],d=0,e=c.length;e>d;d++){var f=c[d];a[f]=b[f]}return a},getCssOrderArr:function(a){var b,c,d,e;return"number"==typeof a?b=c=d=e=a:a instanceof Array?1===a.length?b=c=d=e=a[0]:2===a.length?(b=d=a[0],c=e=a[1]):3===a.length?(b=a[0],c=e=a[1],d=a[2]):(b=a[0],c=a[1],d=a[2],e=a[3]):b=c=d=e=0,[b,c,d,e]}};return function(){var a,b,c,d,e,f,g=[].slice;c=function(a){var b,d;return!_.isObject(a)||_.isFunction(a)?a:_.isDate(a)?new Date(a.getTime()):_.isRegExp(a)?new RegExp(a.source,a.toString().replace(/.*\//,"")):(d=_.isArray(a||_.isArguments(a)),b=function(a,b,e){return d?a.push(c(b)):a[e]=c(b),a},_.reduce(a,b,d?[]:{}))},f=function(a){return!(null!=a&&void 0!=a&&a.prototype!=={}.prototype&&a.prototype!==Object.prototype||!_.isObject(a)||_.isArray(a)||_.isFunction(a)||_.isDate(a)||_.isRegExp(a)||_.isArguments(a))},b=function(a){return _.filter(_.keys(a),function(b){return f(a[b])})},a=function(a){return _.filter(_.keys(a),function(b){return _.isArray(a[b])})},e=function(c,d,f){if(!d)return c;var g,h,i,j,k,l,m,n,o,p;if(null==f&&(f=20),0>=f)return console.warn("_.deepExtend(): Maximum depth of recursion hit."),_.extend(c,d);for(l=_.intersection(b(c),b(d)),h=function(a){return d[a]=e(c[a],d[a],f-1)},m=0,o=l.length;o>m;m++)k=l[m],h(k);for(j=_.intersection(a(c),a(d)),g=function(a){return d[a]},n=0,p=j.length;p>n;n++)i=j[n],g(i);return _.extend(c,d)},d=function(){var a,b,d,f;if(d=2<=arguments.length?g.call(arguments,0,f=arguments.length-1):(f=0,[]),b=arguments[f++],_.isNumber(b)||(d.push(b),b=20),d.length<=1)return d[0];if(0>=b)return _.extend.apply(this,d);for(a=d.shift();d.length>0;)a=e(a,c(d.shift()),b);return a},_.mixin({deepClone:c,isBasicObject:f,basicObjects:b,arrays:a,deepExtend:d})}.call(window),c}),define("canvax/core/PropertyFactory",["canvax/core/Base"],function(a){function b(c,d,f){function g(c,e){(!unwatchOne[c]||unwatchOne[c]&&"$"!==c.charAt(0))&&(d[c]=e);var g=a.getType(e);if("function"===g)unwatchOne[c]||l.push(c);else{if(-1!==_.indexOf(i,c)||"$"===c.charAt(0)&&!f[c])return l.push(c);var m,n;if("object"===g&&"function"==typeof e.get&&_.keys(e).length<=2){var o=e.set,p=e.get;m=function(a){var b=m.value,e=b;return arguments.length?(h||("function"==typeof o&&o.call(j,a),n!==a&&(n=a,b=m.value=d[c]=a,j.$fire&&j.$fire(c,b,e))),void 0):(a=m.value=d[c]=p.call(j),b!==a&&(n=void 0,j.$fire&&j.$fire(c,a,b)),a)}}else m=function(e){var f,i=m.value,k=i;if(!arguments.length)return"object"!==g||i.$model||(i.$parent=j,i=b(i,i),m.value=i),i;var l=a.getType(e);if(!h&&i!==e){"object"===l?(i=e.$model?e:b(e,e),f=i.$model):i=e,m.value=i,d[c]=f?f:i,f||j.$fire&&j.$fire(c,i,k),g!=l&&(g=l);var n=j;if(!j.$watch)for(;n.$parent;)n=n.$parent;n.$watch&&n.$watch.call(n,c,i,k)}},m.value=e;k[c]={set:m,get:m,enumerable:!0}}}var h=!0,i=c.$skipArray,j={},k={},l=_.keys(unwatchOne);d=d||{},f=f||{},i=_.isArray(i)?i.concat(l):l;for(var m in c)g(m,c[m]);return j=e(j,k,l),_.forEach(l,function(a){c[a]&&(j[a]="function"==typeof c[a]?function(){c[a].apply(this,arguments)}:c[a])}),j.$model=d,j.$accessor=k,j.hasOwnProperty=function(a){return a in j.$model},h=!1,j}function c(a,b,c){var d=a[b]&&a[b].set;return 3!==arguments.length?d():(d(c),void 0)}unwatchOne={$skipArray:0,$watch:1,$fire:2,$model:3,$accessor:4,$owner:5,$parent:7};var d=Object.defineProperty;try{d({},"_",{value:"x"});var e=Object.defineProperties}catch(f){"__defineGetter__"in Object&&(d=function(a,b,c){return"value"in c&&(a[b]=c.value),"get"in c&&a.__defineGetter__(b,c.get),"set"in c&&a.__defineSetter__(b,c.set),a},e=function(a,b){for(var c in b)b.hasOwnProperty(c)&&d(a,c,b[c]);return a})}return!e&&window.VBArray&&(window.execScript(["Function parseVB(code)","	ExecuteGlobal(code)","End Function"].join("\n"),"VBScript"),e=function(a,b,d){a=d.slice(0),a.push("hasOwnProperty");var e="VBClass"+setTimeout("1"),f={},g=[];g.push("Class "+e,"	Private [__data__], [__proxy__]","	Public Default Function [__const__](d, p)","		Set [__data__] = d: set [__proxy__] = p","		Set [__const__] = Me","	End Function"),_.forEach(a,function(a){f[a]!==!0&&(f[a]=!0,g.push("	Public ["+a+"]"))});for(var h in b)f[h]=!0,g.push("	Public Property Let ["+h+"](val)",'		Call [__proxy__]([__data__], "'+h+'", val)',"	End Property","	Public Property Set ["+h+"](val)",'		Call [__proxy__]([__data__], "'+h+'", val)',"	End Property","	Public Property Get ["+h+"]","	On Error Resume Next","		Set["+h+'] = [__proxy__]([__data__],"'+h+'")',"	If Err.Number <> 0 Then","		["+h+'] = [__proxy__]([__data__],"'+h+'")',"	End If","	On Error Goto 0","	End Property");return g.push("End Class"),g.push("Function "+e+"Factory(a, b)","	Dim o","	Set o = (New "+e+")(a, b)","	Set "+e+"Factory = o","End Function"),window.parseVB(g.join("\r\n")),window[e+"Factory"](b,c)}),window.PropertyFactory=b,b}),define("canvax/display/Bitmap",["canvax/display/Shape","canvax/core/Base"],function(a,b){var c=function(a){var c=this;c.type="bitmap",c.img=a.img||null,a=b.checkOpt(a),c._context={dx:a.context.dx,dy:a.context.dy,dWidth:a.context.dWidth||0,dHeight:a.context.dHeight||0},arguments.callee.superclass.constructor.apply(this,arguments)};return b.creatClass(c,a,{draw:function(a,b){if(this.img){var c=this.img;b.width&&b.height?void 0==b.dx||void 0==b.dy?a.drawImage(c,0,0,b.width,b.height):(!b.dWidth&&(b.dWidth=b.width),!b.dHeight&&(b.dHeight=b.height),a.drawImage(c,b.dx,b.dy,b.dWidth,b.dHeight,0,0,b.width,b.height)):a.drawImage(c,0,0)}}}),c}),define("canvax/display/DisplayObject",["canvax/event/EventDispatcher","canvax/geom/Matrix","canvax/display/Point","canvax/core/Base","canvax/geom/HitTestPoint","canvax/core/PropertyFactory"],function(a,b,c,d,e,f){var g=function(a){arguments.callee.superclass.constructor.apply(this,arguments);var b=this;a=d.checkOpt(a),b.id=a.id||null,b._transform=null,b._heartBeatNum=0,b.stage=null,b.parent=null,b._eventEnabled=!1,b.dragEnabled=!1,b._createContext(a);var c=d.createId(b.type);null==b.id&&(b.id=c),b.init.apply(b,arguments),this._updateTransform()};return d.creatClass(g,a,{init:function(){},_createContext:function(a){var b=this;b.context=null;var c=d.copy({width:0,height:0,x:0,y:0,scaleX:1,scaleY:1,scaleOrigin:{x:0,y:0},rotation:0,rotateOrigin:{x:0,y:0},visible:!0,cursor:"default",fillStyle:null,lineCap:null,lineJoin:null,lineWidth:null,miterLimit:null,shadowBlur:null,shadowColor:null,shadowOffsetX:null,shadowOffsetY:null,strokeStyle:null,globalAlpha:1,font:null,textAlign:"left",textBaseline:"top",arcScaleX_:null,arcScaleY_:null,lineScale_:null,globalCompositeOperation:null},a.context,!0);b._context&&(c=_.extend(c,b._context)),b._notWatch=!1,c.$owner=b,c.$watch=function(a,b,c){var d=["x","y","scaleX","scaleY","rotation","scaleOrigin","rotateOrigin, lineWidth"];_.indexOf(d,a)>=0&&this.$owner._updateTransform(),this.$owner._notWatch||(this.$owner.$watch&&this.$owner.$watch(a,b,c),this.$owner.heartBeat({convertType:"context",shape:this.$owner,name:a,value:b,preValue:c}))},b.context=f(c)},clone:function(a){var b={id:this.id,context:this.context.$model};this.img&&(b.img=this.img);var c=new this.constructor(b);return a||(c.id=d.createId(c.type)),c},heartBeat:function(a){var b=this.getStage();b&&(this._heartBeatNum++,b.heartBeat&&b.heartBeat(a))},getCurrentWidth:function(){return Math.abs(this.context.width*this.context.scaleX)},getCurrentHeight:function(){return Math.abs(this.context.height*this.context.scaleY)},getStage:function(){if(this.stage)return this.stage;var a=this;if("stage"!=a.type){for(;a.parent&&(a=a.parent,"stage"!=a.type););if("stage"!==a.type)return!1}return this.stage=a,a},localToGlobal:function(a,d){!a&&(a=new c(0,0));var e=this.getConcatenatedMatrix(d);if(null==e)return c(0,0);var f=new b(1,0,0,1,a.x,a.y);return f.concat(e),new c(f.tx,f.ty)},globalToLocal:function(a,d){!a&&(a=new c(0,0));var e=this.getConcatenatedMatrix(d);if(null==e)return new c(0,0);e.invert();var f=new b(1,0,0,1,a.x,a.y);return f.concat(e),new c(f.tx,f.ty)},localToTarget:function(a,b){var c=localToGlobal(a);return b.globalToLocal(c)},getConcatenatedMatrix:function(a){for(var c=new b,d=this;null!=d&&(c.concat(d._transform),!(!d.parent||a&&d.parent&&d.parent==a||d.parent&&"stage"==d.parent.type));d=d.parent);return c},setEventEnable:function(a){return _.isBoolean(a)?(this._eventEnabled=a,!0):!1},getIndex:function(){return this.parent?_.indexOf(this.parent.children,this):void 0},toBack:function(a){if(this.parent){var b=this.getIndex(),c=0;if(_.isNumber(a)){if(0==a)return;c=b-a}var d=this.parent.children.splice(b,1)[0];0>c&&(c=0),this.parent.addChildAt(d,c)}},toFront:function(a){if(this.parent){var b=this.getIndex(),c=this.parent.children.length,d=c;if(_.isNumber(a)){if(0==a)return;d=b+a+1}var e=this.parent.children.splice(b,1)[0];d>c&&(d=c),this.parent.addChildAt(e,d-1)}},_transformHander:function(a){var b=this._transform;b||(b=this._updateTransform()),a.transform.apply(a,b.toArray())},_updateTransform:function(){var a=new b;a.identity();var d=this.context;if(1!==d.scaleX||1!==d.scaleY){var e=new c(d.scaleOrigin);(e.x||e.y)&&a.translate(-e.x,-e.y),a.scale(d.scaleX,d.scaleY),(e.x||e.y)&&a.translate(e.x,e.y)}var f=d.rotation;if(f){var e=new c(d.rotateOrigin);(e.x||e.y)&&a.translate(-e.x,-e.y),a.rotate(f%360*Math.PI/180),(e.x||e.y)&&a.translate(e.x,e.y)}var g=Math.round(d.x),h=Math.round(d.y);return parseInt(d.lineWidth,10)%2==1&&d.strokeStyle&&(g+=.5,h+=.5),(0!=g||0!=h)&&a.translate(g,h),this._transform=a,a},getRect:function(a){return{x:0,y:0,width:a.width,height:a.height}},getChildInPoint:function(a){var b;"stage"!=this.type&&this.parent&&"stage"!=this.parent.type&&(a=this.parent.globalToLocal(a));var c=a.x,d=a.y;if(this._notWatch=!0,this._transform){var f=this._transform.clone().invert(),g=[c,d];f.mulVector(g,[c,d]),c=g[0],d=g[1]}var h=this._rect=this.getRect(this.context);return h?(!this.context.width&&h.width&&(this.context.width=h.width),!this.context.height&&h.height&&(this.context.height=h.height),h.width&&h.height?(b=c>=h.x&&c<=h.x+h.width&&d>=h.y&&d<=h.y+h.height?e.isInside(this,{x:c,y:d}):!1,this._notWatch=!1,b):!1):!1},_render:function(a){!this.context.visible||this.context.globalAlpha<=0||(a.save(),this._transformHander(a),"text"!=this.type&&d.setContextStyle(a,this.context.$model),this.render(a),a.restore())},render:function(){},remove:function(){this.parent&&this.parent.removeChild(this)},destroy:function(){this.remove(),this.context=null,delete this.context}}),g}),define("canvax/display/DisplayObjectContainer",["canvax/core/Base","canvax/display/DisplayObject","canvax/display/Point"],function(a,b){return DisplayObjectContainer=function(){var a=this;a.children=[],a.mouseChildren=[],arguments.callee.superclass.constructor.apply(this,arguments),a._eventEnabled=!0},a.creatClass(DisplayObjectContainer,b,{addChild:function(a){return a?-1!=this.getChildIndex(a)?(a.parent=this,a):(a.parent&&a.parent.removeChild(a),this.children.push(a),a.parent=this,this.heartBeat&&this.heartBeat({convertType:"children",target:a,src:this}),this._afterAddChild&&this._afterAddChild(a),a):void 0},addChildAt:function(a,b){return-1!=this.getChildIndex(a)?(a.parent=this,a):(a.parent&&a.parent.removeChild(a),this.children.splice(b,0,a),a.parent=this,this.heartBeat&&this.heartBeat({convertType:"children",target:a,src:this}),this._afterAddChild&&this._afterAddChild(a,b),a)},removeChild:function(a){return this.removeChildAt(_.indexOf(this.children,a))},removeChildAt:function(a){if(0>a||a>this.children.length-1)return!1;var b=this.children[a];return null!=b&&(b.parent=null),this.children.splice(a,1),this.heartBeat&&this.heartBeat({convertType:"children",target:b,src:this}),this._afterDelChild&&this._afterDelChild(b,a),b},removeChildById:function(a){for(var b=0,c=this.children.length;c>b;b++)if(this.children[b].id==a)return this.removeChildAt(b);return!1},removeAllChildren:function(){for(;this.children.length>0;)this.removeChildAt(0)},destroy:function(){this.parent&&this.parent.removeChild(this),_.each(this.children,function(a){a.destroy()})},getChildById:function(a,b){if(b)return null;for(var c=0,d=this.children.length;d>c;c++)if(this.children[c].id==a)return this.children[c];return null},getChildAt:function(a){return 0>a||a>this.children.length-1?null:this.children[a]},getChildIndex:function(a){return _.indexOf(this.children,a)},setChildIndex:function(a,b){if(a.parent==this){var c=_.indexOf(this.children,a);b!=c&&(this.children.splice(c,1),this.children.splice(b,0,a))}},contains:function(a){return-1!=this.getChildIndex(a)},getNumChildren:function(){return this.children.length},getObjectsUnderPoint:function(a,b){for(var c=[],d=this.children.length-1;d>=0;d--){var e=this.children[d];if(null!=e&&e._eventEnabled&&e.context.visible)if(e instanceof DisplayObjectContainer){if(e.mouseChildren&&e.getNumChildren()>0){var f=e.getObjectsUnderPoint(a);f.length>0&&(c=c.concat(f))}}else if(e.getChildInPoint(a)&&(c.push(e),void 0!=b&&!isNaN(b)&&c.length==b))return c}return c},render:function(a){for(var b=0,c=this.children.length;c>b;b++)this.children[b]._render(a)}}),DisplayObjectContainer}),define("canvax/display/Moveclip",["canvax/display/DisplayObjectContainer","canvax/core/Base"],function(a,b,c){var d=function(a){var b=this;a=c.checkOpt(a),b.type="movieclip",b.currentFrame=0,b.autoPlay=a.autoPlay||!1,b.repeat=a.repeat||0,b.overPlay=a.overPlay||!1,b._frameRate=c.mainFrameRate,b._speedTime=parseInt(1e3/b._frameRate),b._preRenderTime=0,b._context={},arguments.callee.superclass.constructor.apply(this,[a])};return c.creatClass(d,b,{init:function(){},getStatus:function(){return this.autoPlay},getFrameRate:function(){return this._frameRate},setFrameRate:function(a){var b=this;b._frameRate!=a&&(b._frameRate=a,b._speedTime=parseInt(1e3/b._frameRate))},afterAddChild:function(a,b){1!=this.children.length&&void 0!=b&&b<=this.currentFrame&&this.currentFrame++},afterDelChild:function(a,b){this.currentFrame;b<this.currentFrame&&this.currentFrame--,this.currentFrame>=this.children.length&&this.children.length>0&&(this.currentFrame=this.children.length-1)},_goto:function(a){var b=this.children.length;a>=b&&(a%=b),0>a&&(a=this.children.length-1-Math.abs(a)%b),this.currentFrame=a},gotoAndStop:function(a){return this._goto(a),this.autoPlay?(this.autoPlay=!1,void 0):(this._preRenderTime=0,this.getStage().heartBeat(),void 0)},stop:function(){this.autoPlay&&(this.autoPlay=!1)},gotoAndPlay:function(a){this._goto(a),this.play()},play:function(){if(!this.autoPlay){this.autoPlay=!0;var a=this.getStage().parent;a._heartBeat||0!=a._taskList.length||a.__startEnter(),this._push2TaskList(),this._preRenderTime=(new Date).getTime()}},_push2TaskList:function(){this._enterInCanvax||(this.getStage().parent._taskList.push(this),this._enterInCanvax=!0)},_enterInCanvax:!1,__enterFrame:function(){var a=this;c.now-a._preRenderTime>=a._speedTime&&a.getStage().heartBeat()},next:function(){var a=this;a.autoPlay||a.gotoAndStop(a._next())},pre:function(){var a=this;a.autoPlay||a.gotoAndStop(a._pre())},_next:function(){return this.currentFrame>=this.children.length-1?this.currentFrame=0:this.currentFrame++,this.currentFrame},_pre:function(){return 0==this.currentFrame?this.currentFrame=this.children.length-1:this.currentFrame--,this.currentFrame},render:function(a){if(this.overPlay)for(var b=0;b<=this.currentFrame;b++)this.getChildAt(b)._render(a);else this.getChildAt(this.currentFrame)._render(a);if(1==this.children.length&&(this.autoPlay=!1),this.currentFrame==this.getNumChildren()-1&&(this.repeat||(this.stop(),this.hasEvent("end")&&this.fire("end")),_.isNumber(this.repeat)&&this.repeat>0&&this.repeat--),this.autoPlay)c.now-this._preRenderTime>=this._speedTime&&(this._preRenderTime=c.now,this._next()),this._push2TaskList();else if(this._enterInCanvax){this._enterInCanvax=!1;var d=this.getStage().parent._taskList;d.splice(_.indexOf(d,this),1)}}}),d}),define("canvax/display/Point",[],function(){var a=function(a,b){if(1!=arguments.length||"object"!=typeof arguments[0])a||(a=0),b||(b=0),this.x=1*a,this.y=1*b;else{var c=arguments[0];if("x"in c&&"y"in c)this.x=1*c.x,this.y=1*c.y;else{var d=0;for(var e in c){if(0!=d){this.y=1*c[e];break}this.x=1*c[e],d++}}}};return a}),define("canvax/display/Shape",["canvax/display/DisplayObject","canvax/core/Base"],function(a,b){var c=function(a){var b=this;b._hoverable=!1,b._clickable=!1,b._hoverClass=!1,b._dragDuplicate=null,b.type=b.type||"shape",a.draw&&(b.draw=a.draw),arguments.callee.superclass.constructor.apply(this,arguments),b._rect=null};return b.creatClass(c,a,{init:function(){},draw:function(){},drawEnd:function(a){if(!this._hasFillAndStroke){var b=this.context;"stroke"!=this._drawTypeOnly&&"path"!=this.type&&a.closePath(),b.strokeStyle&&b.lineWidth&&a.stroke(),b.fillStyle&&"stroke"!=this._drawTypeOnly&&a.fill()}},render:function(){var a=this.getStage().context2D;"shape"==this.context.type?this.draw.apply(this):this.draw&&(a.beginPath(),this.draw(a,this.context),this.drawEnd(a))},dashedLineTo:function(a,b,c,d,e,f){f="undefined"==typeof f?3:f,f=Math.max(f,this.context.lineWidth);for(var g=d-b,h=e-c,i=Math.floor(Math.sqrt(g*g+h*h)/f),j=0;i>j;++j){var k=parseInt(b+g/i*j),l=parseInt(c+h/i*j);a[j%2===0?"moveTo":"lineTo"](k,l),j==i-1&&j%2===0&&a.lineTo(d,e)}},getRectFormPointList:function(a){for(var b=Number.MAX_VALUE,c=Number.MIN_VALUE,d=Number.MAX_VALUE,e=Number.MIN_VALUE,f=a.pointList,g=0,h=f.length;h>g;g++)f[g][0]<b&&(b=f[g][0]),f[g][0]>c&&(c=f[g][0]),f[g][1]<d&&(d=f[g][1]),f[g][1]>e&&(e=f[g][1]);var i;return i=a.strokeStyle||a.fillStyle?a.lineWidth||1:0,{x:Math.round(b-i/2),y:Math.round(d-i/2),width:c-b+i,height:e-d+i}}}),c}),define("canvax/display/Sprite",["canvax/display/DisplayObjectContainer","canvax/core/Base"],function(a,b){var c=function(){var a=this;a.type="sprite",arguments.callee.superclass.constructor.apply(this,arguments)};return b.creatClass(c,a,{init:function(){}}),c}),define("canvax/display/Stage",["canvax/display/DisplayObjectContainer","canvax/core/Base"],function(a,b){var c=function(){var a=this;a.type="stage",a.context2D=null,a.stageRending=!1,a._isReady=!1,arguments.callee.superclass.constructor.apply(this,arguments)};return b.creatClass(c,a,{init:function(){},initStage:function(a,c,d){var e=this;e.context2D=a,e.context.width=c,e.context.height=d,e.context.scaleX=b._devicePixelRatio,e.context.scaleY=b._devicePixelRatio,e._isReady=!0},render:function(a){this.stageRending=!0,this.clear(),c.superclass.render.call(this,a),this.stageRending=!1},heartBeat:function(a){this._isReady&&(a||(a={}),a.stage=this,this.parent&&this.parent.heartBeat(a))},clear:function(a,b,c,d){arguments.length>=4?this.context2D.clearRect(a,b,c,d):this.context2D.clearRect(0,0,this.context2D.canvas.width,this.context2D.canvas.height)}}),c}),define("canvax/display/Text",["canvax/display/DisplayObject","canvax/core/Base"],function(a,b){var c=function(a,c){var d=this;d.type="text",d._reNewline=/\r?\n/,d.fontProperts=["fontStyle","fontVariant","fontWeight","fontSize","fontFamily"],c=b.checkOpt(c),d._context={fontSize:c.context.fontSize||13,fontWeight:c.context.fontWeight||"normal",fontFamily:c.context.fontFamily||"微软雅黑",textDecoration:c.context.textDecoration,fillStyle:c.context.fontColor||c.context.fillStyle||"blank",lineHeight:c.context.lineHeight||1.3,backgroundColor:c.context.backgroundColor,textBackgroundColor:c.context.textBackgroundColor},d._context.font=d._getFontDeclaration(),d.text=a.toString(),arguments.callee.superclass.constructor.apply(this,[c])};return b.creatClass(c,DisplayObjectContainer,{$watch:function(a){a in this.fontProperts&&(this._notWatch=!1,this.context.font=this._getFontDeclaration())},init:function(){},render:function(a){var b=this._getTextLines();this.context.width=this._getTextWidth(a,b),this.context.height=this._getTextHeight(a,b);for(p in this.context.$model)p in a&&"textBaseline"!=p&&this.context.$model[p]&&(a[p]=this.context.$model[p]);this._renderText(a,b)},resetText:function(a){this.text=a.toString(),this.heartBeat()},getTextWidth:function(){var a=0;return b._pixelCtx.save(),b._pixelCtx.font=this.context.font,a=this._getTextWidth(b._pixelCtx,this._getTextLines()),b._pixelCtx.restore(),a},getTextHeight:function(){return this._getTextHeight(b._pixelCtx,this._getTextLines())},_getTextLines:function(){return this.text.split(this._reNewline)},_renderText:function(a,b){a.save(),this._renderTextFill(a,b),this._renderTextStroke(a,b),a.restore()},_getFontDeclaration:function(){var a=this,b=[];return _.each(this.fontProperts,function(c){var d=a._context[c];"fontSize"==c&&(d=parseFloat(d)+"px"),d&&b.push(d)}),b.join(" ")},_renderTextFill:function(a,b){if(this.context.fillStyle){this._boundaries=[];for(var c=0,d=0,e=b.length;e>d;d++){var f=this._getHeightOfLine(a,d,b);c+=f,this._renderTextLine("fillText",a,b[d],0,this._getTopOffset()+c,d)}}},_renderTextStroke:function(a,b){if(this.context.strokeStyle&&this.context.lineWidth||this._skipFillStrokeCheck){var c=0;a.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),supportsLineDash&&a.setLineDash(this.strokeDashArray)),a.beginPath();for(var d=0,e=b.length;e>d;d++){var f=this._getHeightOfLine(a,d,b);c+=f,this._renderTextLine("strokeText",a,b[d],0,this._getTopOffset()+c,d)}a.closePath(),a.restore()}},_renderTextLine:function(a,b,c,d,e,f){if(e-=this.context.fontSize/4,"justify"!==this.context.textAlign)return this._renderChars(a,b,c,d,e,f),void 0;var g=b.measureText(c).width,h=this.context.width;if(h>g)for(var i=c.split(/\s+/),j=b.measureText(c.replace(/\s+/g,"")).width,k=h-j,l=i.length-1,m=k/l,n=0,o=0,p=i.length;p>o;o++)this._renderChars(a,b,i[o],d+n,e,f),n+=b.measureText(i[o]).width+m;else this._renderChars(a,b,c,d,e,f)},_renderChars:function(a,b,c,d,e){b[a](c,0,e)},_getHeightOfLine:function(){return this.context.fontSize*this.context.lineHeight},_getTextWidth:function(a,b){for(var c=a.measureText(b[0]||"|").width,d=1,e=b.length;e>d;d++){var f=a.measureText(b[d]).width;f>c&&(c=f)}return c},_getTextHeight:function(a,b){return this.context.fontSize*b.length*this.context.lineHeight},_getTopOffset:function(){var a=0;switch(this.context.textBaseline){case"top":a=0;break;case"middle":a=-this.context.height/2;break;case"bottom":a=-this.context.height}return a}}),c}),define("canvax/event/CanvaxEvent",["canvax/event/EventBase","canvax/core/Base"],function(a,b){var c=function(b,c,d){a.call(this,b,c,d),this.mouseX=0,this.mouseY=0};b.creatClass(c,a,{toString:function(){return"[CanvaxEvent type="+this.type+", mouseX="+this.mouseX+", mouseY="+this.mouseY+"]"}}),c.EVENTS=["click","mousedown","mousemove","mouseup","mouseout"];var d=function(a,b){return document[a]?function(b,c,d){if(b.length)for(var e=0;e<b.length;e++)arguments.callee(b[e],c,d);else b[a](c,d,!1)}:function(a,c,d){if(a.length)for(var e=0;e<a.length;e++)arguments.callee(a[e],c,d);else a[b]("on"+c,function(){return d.call(a,window.event)})}};return c.addEvent=d("addEventListener","attachEvent"),c.removeEvent=d("removeEventListener","detachEvent"),c.stopDefault=function(a){return a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1,!1},c}),define("canvax/event/EventBase",["canvax/core/Base"],function(){var a=function(a,b,c){this.type=a,this.target=null,this.currentTarget=null,this.params=null,this.bubbles=void 0!=b?b:!1,this.cancelable=void 0!=c?c:!1,this._stopPropagation=!1};return a.prototype.stopPropagation=function(){this._stopPropagation=!0},a.prototype.preventDefault=function(){},a.prototype.clone=function(){return Base.copy(this)},a.prototype.dispose=function(){delete this.type,delete this.target,delete this.currentTarget,delete this.params},a}),define("canvax/event/EventDispatcher",["canvax/core/Base","canvax/event/EventManager"],function(a,b){var c=function(){arguments.callee.superclass.constructor.call(this,name)};return a.creatClass(c,b,{on:function(a,b){return this._addEventListener(a,b),this},addEventListener:function(a,b){return this._addEventListener(a,b),this},un:function(a,b){return this._removeEventListener(a,b),this},removeEventListener:function(a,b){return this._removeEventListener(a,b),this},removeEventListenerByType:function(a){return this._removeEventListenerByType(a),this},removeAllEventListeners:function(){return this._removeAllEventListeners(),this},fire:function(a,b){return b?b.type=a:b={type:a},this.dispatchEvent(b),this},dispatchEvent:function(a){if("mouseover"!=a.type){if(this._dispatchEvent(a),"mouseout"==a.type&&this._hoverClass){var b=this.getStage().parent;this._hoverClass=!1,b._hoverStage.removeChildById(this.id),this.context.globalAlpha=this._globalAlpha,delete this._globalAlpha}return this}var c=this._heartBeatNum;if(this._dispatchEvent(a),c!=this._heartBeatNum){this._hoverClass=!0;var b=this.getStage().parent,d=this.clone(!0);d._transform=this.getConcatenatedMatrix(),b._hoverStage.addChildAt(d,0),this._globalAlpha=this.context.globalAlpha,this.context.globalAlpha=0}},hasEvent:function(a){return this._hasEventListener(a)},hasEventListener:function(a){return this._hasEventListener(a)},hover:function(a,b){return this.on("mouseover",a),this.on("mouseout",b),this},once:function(a,b){return this.on(a,function(){b.apply(this,arguments),this.un(a,arguments.callee)}),this}}),c}),define("canvax/event/EventManager",[],function(){var a=function(){this._eventMap={}};return a.prototype={_addEventListener:function(a,b){if("function"!=typeof b)return!1;var c=!0,d=this;return _.each(a.split(" "),function(a){var e=d._eventMap[a];return e?-1==_.indexOf(e,b)?(e.push(b),d._eventEnabled=!0,!0):(c=!1,void 0):(e=d._eventMap[a]=[],e.push(b),d._eventEnabled=!0,!0)}),c},_removeEventListener:function(a,b){if(1==arguments.length)return this.removeEventListenerByType(a);var c=this._eventMap[a];if(!c)return!1;for(var d=0;d<c.length;d++){var e=c[d];if(e===b)return c.splice(d,1),0==c.length&&(delete this._eventMap[a],_.isEmpty(this._eventMap)&&(this._eventEnabled=!1)),!0}return!1},_removeEventListenerByType:function(a){var b=this._eventMap[a];return b?!1:(delete this._eventMap[a],_.isEmpty(this._eventMap)&&(this._eventEnabled=!1),!0)},_removeAllEventListeners:function(){this._eventMap={},this._eventEnabled=!1},_dispatchEvent:function(a){var b=this._eventMap[a.type];if(b){a.target||(a.target=this),b=b.slice();for(var c=0;c<b.length;c++){var d=b[c];"function"==typeof d&&d.call(this,a)}}return a._stopPropagation||this.parent&&(a.currentTarget=this.parent,this.parent._dispatchEvent(a)),!0},_hasEventListener:function(a){var b=this._eventMap[a];return null!=b&&b.length>0}},a}),define("canvax/geom/HitTestPoint",["canvax/core/Base","canvax/geom/Math"],function(a,b){function c(b,c){var g=c.x,h=c.y;if("bitmap"==b.type)return!0;if(!b||!b.type)return!1;var i=b.type,j=d(i,b,g,h);if("undefined"!=typeof j)return j;if("beziercurve"!=i&&b.buildPath&&a._pixelCtx.isPointInPath)return e(b,a._pixelCtx,g,h);if(a._pixelCtx.getImageData)return f(b,g,h);switch(i){case"heart":return!0;case"droplet":return!0;case"ellipse":return!0;default:return!1}}function d(a,b,c,d){switch(a){case"line":return i(b.context,c,d);case"brokenLine":return j(b,c,d);case"text":return!0;case"ring":return k(b,c,d);case"rect":return!0;case"circle":return m(b,c,d);case"ellipse":return o(b,c,d);case"sector":return n(b,c,d);case"path":return q(b,c,d);case"polygon":case"star":case"isogon":return p(b,c,d);case"image":return!0}}function e(a,b,c,d){var b=a.context;return b.beginPath(),a.buildPath(b,b),b.closePath(),b.isPointInPath(c,d)}function f(b,c,d){var e=b.context,f=a._pixelCtx;f.save(),f.beginPath(),a.setContextStyle(f,e.$model),f.transform.apply(f,b.getConcatenatedMatrix().toArray()),f.clearRect(b._rect.x-10,b._rect.y-10,b._rect.width+20,b._rect.height+20),b.draw(f,e),f.globalAlpha=1,b.drawEnd(f),f.closePath(),f.restore();var h=b.getConcatenatedMatrix();if(h){var i=h.clone(),j=[c,d];i.mulVector(j,[c,d,1]),c=j[0],d=j[1]}return g(f,c,d)}function g(a,b,c,d){var e;"undefined"!=typeof d?(d=Math.floor((d||1)/2),e=a.getImageData(b-d,c-d,d+d,d+d).data):e=a.getImageData(b,c,1,1).data;for(var f=e.length;f--;)if(0!==e[f])return!0;return!1}function h(a,b,d){return!c(a,b,d)}function i(a,b,c){var d=a.xStart,e=a.yStart,f=a.xEnd,g=a.yEnd,h=a.lineWidth,i=0,j=d;if(d===f)return Math.abs(b-d)<=h/2;i=(e-g)/(d-f),j=(d*g-f*e)/(d-f);var k=(i*b-c+j)*(i*b-c+j)/(i*i+1);return h/2*h/2>=k}function j(a,b,c){for(var d,e=a.context,f=e.pointList,g=!1,h=0,j=f.length-1;j>h&&(d={xStart:f[h][0],yStart:f[h][1],xEnd:f[h+1][0],yEnd:f[h+1][1],lineWidth:e.lineWidth},!l({x:Math.min(d.xStart,d.xEnd)-d.lineWidth,y:Math.min(d.yStart,d.yEnd)-d.lineWidth,width:Math.abs(d.xStart-d.xEnd)+d.lineWidth,height:Math.abs(d.yStart-d.yEnd)+d.lineWidth},b,c)||!(g=i(d,b,c)));h++);return g}function k(a,b,c){var d=a.context;return m(a,b,c)&&!m(a,b,c,d.r0||0)?!0:!1}function l(a,b,c){return b>=a.x&&b<=a.x+a.width&&c>=a.y&&c<=a.y+a.height?!0:!1
}function m(a,b,c,d){var e=a.context;return!d&&(d=e.r),d*d>b*b+c*c}function n(a,c,d){var e=a.context;if(!m(a,c,d)||e.r0>0&&m(a,c,d,e.r0))return!1;var f=b.degreeTo360(e.startAngle),g=b.degreeTo360(e.endAngle),h=b.degreeTo360(Math.atan2(d,c)/Math.PI*180%360),i=!0;(f>g&&!e.clockwise||g>f&&e.clockwise)&&(i=!1);var j=[Math.min(f,g),Math.max(f,g)],k=h>j[0]&&h<j[1];return k&&i||!k&&!i}function o(a,b,c){var d,e=a.context,f={x:0,y:0},g=e.hr,h=e.vr,i={x:b,y:c};return i.x-=f.x,i.y-=f.y,i.x*=i.x,i.y*=i.y,g*=g,h*=h,d=h*i.x+g*i.y-g*h,0>d}function p(a,b,c){var d,e,f,g=a.context?a.context:a,h=g.pointList,i=h.length,j=!1,k=!0;for(d=0;i>d;++d)if(h[d][0]==b&&h[d][1]==c){k=!1,j=!0;break}if(k)for(k=!1,j=!1,d=0,e=i-1;i>d;e=d++)if(h[d][1]<c&&c<h[e][1]||h[e][1]<c&&c<h[d][1]){if(b<=h[d][0]||b<=h[e][0])if(f=(c-h[d][1])*(h[e][0]-h[d][0])/(h[e][1]-h[d][1])+h[d][0],f>b)j=!j;else if(b==f){j=!0;break}}else if(c==h[d][1]){if(b<h[d][0]){h[d][1]>h[e][1]?--c:++c;break}}else if(h[d][1]==h[e][1]&&c==h[d][1]&&(h[d][0]<b&&b<h[e][0]||h[e][0]<b&&b<h[d][0])){j=!0;break}return j}function q(a,b,c){for(var d=a.context,e=d.pointList,f=!1,g=0,h=e.length;h>g&&!(f=p({pointList:e[g]},b,c));g++);return f}function r(b,c){a._pixelCtx.save(),c&&(a._pixelCtx.font=c);var d=a._pixelCtx.measureText(b).width;return a._pixelCtx.restore(),d}var s={};return s={isInside:c,isOutside:h,getTextWidth:r}}),define("canvax/geom/Math",[],function(){function a(a,b){return a=(b?a*g:a).toFixed(4),"undefined"==typeof f.sin[a]&&(f.sin[a]=Math.sin(a)),f.sin[a]}function b(a,b){return a=(b?a*g:a).toFixed(4),"undefined"==typeof f.cos[a]&&(f.cos[a]=Math.cos(a)),f.cos[a]}function c(a){return a*g}function d(a){return a/g}function e(a){var b=Math.abs(360+Math.ceil(a)%360)%360;return 0==b&&0!==a&&(b=360),b}var f={sin:{},cos:{}},g=Math.PI/180;return{PI:Math.PI,sin:a,cos:b,degreeToRadian:c,radianToDegree:d,degreeTo360:e}}),define("canvax/geom/Matrix",["canvax/core/Base"],function(a){var b=function(a,b,c,d,e,f){this.a=void 0!=a?a:1,this.b=void 0!=b?b:0,this.c=void 0!=c?c:0,this.d=void 0!=d?d:1,this.tx=void 0!=e?e:0,this.ty=void 0!=f?f:0};return a.creatClass(b,function(){},{concat:function(a){var b=this.a,c=this.c,d=this.tx;return this.a=b*a.a+this.b*a.c,this.b=b*a.b+this.b*a.d,this.c=c*a.a+this.d*a.c,this.d=c*a.b+this.d*a.d,this.tx=d*a.a+this.ty*a.c+a.tx,this.ty=d*a.b+this.ty*a.d+a.ty,this},concatTransform:function(a,c,d,e,f){var g=1,h=0;if(f%360){var i=f*Math.PI/180;g=Math.cos(i),h=Math.sin(i)}return this.concat(new b(g*d,h*d,-h*e,g*e,a,c)),this},rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=this.a,e=this.c,f=this.tx;if(a>0)this.a=d*b-this.b*c,this.b=d*c+this.b*b,this.c=e*b-this.d*c,this.d=e*c+this.d*b,this.tx=f*b-this.ty*c,this.ty=f*c+this.ty*b;else{var g=Math.sin(Math.abs(a)),h=Math.cos(Math.abs(a));this.a=d*h+this.b*g,this.b=-d*g+this.b*h,this.c=e*h+this.d*g,this.d=-e*g+h*this.d,this.tx=h*f+g*this.ty,this.ty=h*this.ty-g*f}return this},scale:function(a,b){return this.a*=a,this.d*=b,this.tx*=a,this.ty*=b,this},translate:function(a,b){return this.tx+=a,this.ty+=b,this},identity:function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},invert:function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.tx,f=a*d-b*c;return this.a=d/f,this.b=-b/f,this.c=-c/f,this.d=a/f,this.tx=(c*this.ty-d*e)/f,this.ty=-(a*this.ty-b*e)/f,this},clone:function(){return new b(this.a,this.b,this.c,this.d,this.tx,this.ty)},toString:function(){return"(a="+this.a+", b="+this.b+", c="+this.c+", d="+this.d+", tx="+this.tx+", ty="+this.ty+")"},toArray:function(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]},mulVector:function(a,b){var c=this.a,d=this.c,e=this.tx,f=this.b,g=this.d,h=this.ty;return a[0]=b[0]*c+b[1]*d+e,a[1]=b[0]*f+b[1]*g+h,a}}),b}),define("canvax/index",["canvax/core/Base","canvax/event/CanvaxEvent","canvax/event/EventBase","canvax/event/EventDispatcher","canvax/event/EventManager","canvax/display/DisplayObjectContainer","canvax/display/Stage","canvax/display/Sprite","canvax/display/Shape","canvax/display/Point","canvax/display/Text"],function(a,b,c,d,e,f,g,h,i,j,k){var l=function(b){this.type="canvax",this._cid=(new Date).getTime()+"_"+Math.floor(100*Math.random()),this._rootDom=a.getEl(b.el),this.width=parseInt("width"in b||this._rootDom.offsetWidth,10),this.height=parseInt("height"in b||this._rootDom.offsetHeight,10),this.preventDefault=!0,b.preventDefault===!1&&(this.preventDefault=!1);var c="<div id='cc-"+this._cid+"' class='canvax-c' ";c+="style='position:relative;width:"+this.width+"px;height:"+this.height+"px;'>",c+="   <div id='cdc-"+this._cid+"' class='canvax-dom-container' ",c+="   style='position:absolute;width:"+this.width+"px;height:"+this.height+"px;'>",c+="   </div>",c+="</div>",this._rootDom.innerHTML=c,this.el=a.getEl("cc-"+this._cid),this.rootOffset=a.getOffset(this.el),this.curPoints=[new j(0,0)],this.curPointsTarget=[],this.convertStages={},this._heartBeat=!1,this._speedTime=parseInt(1e3/a.mainFrameRate),this._preRenderTime=0,this._taskList=[],this._hoverStage=null,this._isReady=!1,this._touching=!1,this._draging=!1,this._cursor="default",arguments.callee.superclass.constructor.apply(this,arguments)};return a.creatClass(l,f,{init:function(){this.context.width=this.width,this.context.height=this.height,this._creatHoverStage(),this._initEvent(),this._createPixelContext(),this._isReady=!0},resize:function(){this.width=parseInt(this._rootDom.offsetWidth),this.height=parseInt(this._rootDom.offsetHeight),this.el.style.width=this.width+"px",this.el.style.height=this.height+"px",this.rootOffset=a.getOffset(this.el),this._notWatch=!0,this.context.width=this.width,this.context.height=this.height,this._notWatch=!1;var b=this,c=function(c){var d=c.canvas;d.style.width=b.width+"px",d.style.height=b.height+"px",d.setAttribute("width",b.width*a._devicePixelRatio),d.setAttribute("height",b.height*a._devicePixelRatio),c.resize&&c.resize(b.width,b.height)};_.each(this.children,function(a){a._notWatch=!0,a.context.width=b.width,a.context.height=b.height,c(a.context2D),a._notWatch=!1});var d=a.getEl("cdc-"+this._cid);d.style.width=this.width+"px",d.style.height=this.height+"px",this.heartBeat()},getDomContainer:function(){return a.getEl("cdc-"+this._cid)},getHoverStage:function(){return this._hoverStage},_creatHoverStage:function(){this._hoverStage=new g({id:"activCanvas"+(new Date).getTime(),context:{width:this.context.width,height:this.context.height}}),this._hoverStage._eventEnabled=!1,this.addChild(this._hoverStage)},_createPixelContext:function(){var b=a.getEl("_pixelCanvas");b||(b=a._createCanvas("_pixelCanvas",this.context.width,this.context.height),document.body.appendChild(b),a.initElement(b),a.canvasSupport()?b.style.display="none":(b.style.zIndex=-1,b.style.position="absolute",b.style.left=-this.context.width+"px",b.style.top=-this.context.height+"px",b.style.visibility="hidden"),a._pixelCtx=b.getContext("2d"))},_initEvent:function(){var c=this,d=0;if(window.Hammer&&Hammer.NO_MOUSEEVENTS||_.each(b.EVENTS,function(a){b.addEvent(c.el,a,function(a){if("mousemove"==a.type){if(1>d)return d++,void 0;d=0}c.__mouseHandler(a)})}),window.Hammer&&Hammer.HAS_TOUCHEVENTS){var e=c.el;c._hammer=Hammer(e).on(Hammer.EventsTypes,function(b){if("drag"==b.type){if(1>d)return d++,void 0;d=0}"touch"==b.type&&(c.rootOffset=a.getOffset(c.el)),c.__touchHandler(b)})}},__touchHandler:function(a){var b=this;if(this._hammer.options.prevent_default=this.preventDefault?!0:!1,b.curPoints=b.__getCanvaxPointInTouchs(a),"release"==a.type)b.__dispatchEventInChilds(a,b.curPointsTarget)||b.__dispatchEventInChilds(a,[b]);else{"dragstart"==a.type&&_.each(b.curPointsTarget,function(a,c){return a&&a.dragEnabled?(b._draging=!0,b._clone2hoverStage(a,c),a.context.visible=!1,!1):void 0}),"drag"==a.type&&b._draging&&_.each(b.curPointsTarget,function(c,d){c&&c.dragEnabled&&b._dragHander(a,c,d)}),"dragend"==a.type&&b._draging&&(_.each(b.curPointsTarget,function(c){c&&c.dragEnabled&&b._dragEnd(a,c,0)}),b._draging=!1);var c=b.__getChildInTouchs(b.curPoints);b.__dispatchEventInChilds(a,c)?"touch"==a.type&&(b.curPointsTarget=c):b.__dispatchEventInChilds(a,[b])}},__dispatchEventInChilds:function(c,d){if(!(d||"length"in d))return!1;var e=this,f=!1;return _.each(d,function(d,g){if(d){f=!0;var h=a.copyEvent(new b,c);h.target=h.currentTarget=d||this,h.stagePoint=e.curPoints[g],h.point=h.target.globalToLocal(h.stagePoint),d.dispatchEvent(h)}}),f},__getCanvaxPointInTouchs:function(a){var b=this,c=[];return _.each(a.gesture.touches,function(a){a.x=a.pageX-b.rootOffset.left,a.y=a.pageY-b.rootOffset.top,c.push(a)}),c},__getChildInTouchs:function(a){var b=this,c=[];return _.each(a,function(a){c.push(b.getObjectsUnderPoint(a,1)[0])}),c},__mouseHandler:function(a){var c=this;c.curPoints=[new j((a.pageX||a.x)-c.rootOffset.left,(a.pageY||a.y)-c.rootOffset.top)];var d=c.curPoints[0],e=c.curPointsTarget[0];if("mousedown"==a.type){if(!e){var f=c.getObjectsUnderPoint(d,1)[0];f&&(c.curPointsTarget=[f])}e=c.curPointsTarget[0],e&&c.dragEnabled&&(c._touching=!0)}var g=document.compareDocumentPosition?function(a,b){return!!(16&a.compareDocumentPosition(b))}:function(a,b){return b!==b&&(a.contains?a.contains(b):!0)};if(("mouseup"==a.type||"mouseout"==a.type&&!g(c.el,a.toElement||a.relatedTarget))&&(1==c._draging&&c._dragEnd(a,e,0),c._draging=!1,c._touching=!1),"mouseout"==a.type)g(c.el,a.toElement||a.relatedTarget)||c.__getcurPointsTarget(a,d);else if("mousemove"==a.type)c._touching&&"mousemove"==a.type&&e?(c._draging?c._dragHander(a,e,0):(e.dragBegin&&e.dragBegin(a),e.context.visible=!1,c._clone2hoverStage(e,0)),c._draging=!0):c.__getcurPointsTarget(a,d);else{var h=e;h||(h=c),c.__dispatchEventInChilds(a,[h])}this.preventDefault&&b.stopDefault(a)},__getcurPointsTarget:function(c,d){var e=this.curPointsTarget[0],c=a.copyEvent(new b,c);if("mousemove"==c.type&&e&&e._hoverClass&&e.getChildInPoint(d))return c.target=c.currentTarget=e,c.point=e.globalToLocal(d),this._mouseEventDispatch(e,c),void 0;var f=this.getObjectsUnderPoint(d,1)[0];if(this._cursorHander(f,e),e&&e!=f||"mouseout"==c.type){if(!e)return;this.curPointsTarget[0]=null,c.type="mouseout",c.target=c.currentTarget=e,c.point=e.globalToLocal(d),e.context.visible||(e.context.visible=!0),this._mouseEventDispatch(e,c)}f&&e!=f&&(this.curPointsTarget[0]=f,c.type="mouseover",c.target=c.currentTarget=f,c.point=f.globalToLocal(d),this._mouseEventDispatch(f,c)),"mousemove"==c.type&&f&&(c.target=c.currentTarget=e,c.point=e.globalToLocal(d),this._mouseEventDispatch(e,c))},_mouseEventDispatch:function(a,b){a.dispatchEvent(b)},_clone2hoverStage:function(a,b){var c=this,d=c._hoverStage.getChildById(a.id);d||(d=a.clone(!0),d._transform=a.getConcatenatedMatrix(),c._hoverStage.addChildAt(d,0)),d.context.visible=!0,d._dragPoint=a.globalToLocal(c.curPoints[b])},_dragHander:function(a,b,c){var d=this,e=d._hoverStage.getChildById(b.id),f=new j(d.curPoints[c].x-e._dragPoint.x,d.curPoints[c].y-e._dragPoint.y);e.context.x=f.x,e.context.y=f.y,b.drag&&b.drag(a);var g=f;"stage"!=b.type&&b.parent&&"stage"!=b.parent.type&&(g=b.parent.globalToLocal(f)),b._notWatch=!0,b.context.x=g.x,b.context.y=g.y,b._notWatch=!1},_dragEnd:function(a,b){var c=this._hoverStage.getChildById(b.id);b.context.visible=!0,("mouseout"==a.type||"dragend"==a.type)&&c.destroy()},_cursorHander:function(a,b){a||b||this.setCursor("default"),a&&b!=a&&this.setCursor(a.context.cursor)},setCursor:function(a){this._cursor!=a&&(this.el.style.cursor=a,this._cursor=a)},setFrameRate:function(b){a.mainFrameRate!=b&&(a.mainFrameRate=b,this._speedTime=parseInt(1e3/a.mainFrameRate))},getFrameRate:function(){return a.mainFrameRate},__startEnter:function(){var a=this;a.requestAid||(a.requestAid=requestAnimationFrame(_.bind(a.__enterFrame,a)))},__enterFrame:function(){var b=this;if(b.requestAid=null,a.now=(new Date).getTime(),b._heartBeat){if(a.now-b._preRenderTime<b._speedTime)return b.__startEnter(),void 0;b.fire("beginRender"),_.each(_.values(b.convertStages),function(a){a.stage._render(a.stage.context2D)}),b._heartBeat=!1,b.convertStages={},b._preRenderTime=(new Date).getTime(),b.fire("afterRender")}if(b._taskList.length>0)for(var c=0,d=b._taskList.length;d>c;c++){var e=b._taskList[c];e.__enterFrame?e.__enterFrame():b.__taskList.splice(c--,1)}b._taskList.length>0&&b.__startEnter()},_afterAddChild:function(b,c){var d,e=!0;b.context2D?d=b.context2D.canvas:(e=!1,d=a._createCanvas(b.id,this.context.width,this.context.height));var f=a.getEl("cdc-"+this._cid);1==this.children.length?this.el.insertBefore(d,f):this.children.length>1&&(void 0==c?this.el.insertBefore(d,this._hoverStage.context2D.canvas):c>=this.children.length-1?this.el.insertBefore(d,f):this.el.insertBefore(d,this.children[c].context2D.canvas)),e||a.initElement(d),b.initStage(d.getContext("2d"),this.context.width,this.context.height)},_afterDelChild:function(a){this.el.removeChild(a.context2D.canvas)},_convertCanvax:function(a){_.each(this.children,function(b){b.context[a.name]=a.value})},heartBeat:function(a){var b=this;if(a){if("context"==a.convertType){{var c=a.stage,d=a.shape;a.name,a.value,a.preValue}if(!b._isReady)return;if("canvax"==d.type)b._convertCanvax(a);else if(b.convertStages[c.id]||(b.convertStages[c.id]={stage:c,convertShapes:{}}),d){if(b.convertStages[c.id].convertShapes[d.id])return;b.convertStages[c.id].convertShapes[d.id]={shape:d,convertType:a.convertType}}}if("children"==a.convertType){var e=a.target,c=a.src.getStage();(c||"stage"==e.type)&&(c=c||e,b.convertStages[c.id]||(b.convertStages[c.id]={stage:c,convertShapes:{}}))}if(!a.convertType){var c=a.stage;b.convertStages[c.id]||(b.convertStages[c.id]={stage:c,convertShapes:{}})}}else _.each(b.children,function(a){b.convertStages[a.id]={stage:a,convertShapes:{}}});b._heartBeat?b._heartBeat=!0:(b._heartBeat=!0,b.__startEnter())}}),l.Display={Stage:g,Sprite:h,Shape:i,Point:j,Text:k},l.Event={CanvaxEvent:b,EventBase:c,EventDispatcher:d,EventManager:e},l});
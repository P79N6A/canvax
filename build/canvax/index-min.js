KISSY.add("canvax/animation/AnimationFrame",function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}),KISSY.add("canvax/core/Base",function(){var a={};"Boolean Number String Function Array Date RegExp Object Error".replace(/[^, ]+/g,function(b){a["[object "+b+"]"]=b.toLowerCase()});var b={mainFrameRate:60,now:0,_pixelCtx:null,__emptyFunc:function(){},_devicePixelRatio:window.devicePixelRatio||1,_createCanvas:function(a,b,c){var d=document.createElement("canvas");return d.style.position="absolute",d.style.width=b+"px",d.style.height=c+"px",d.setAttribute("width",b*this._devicePixelRatio),d.setAttribute("height",c*this._devicePixelRatio),d.setAttribute("id",a),d},canvasSupport:function(){return!!document.createElement("canvas").getContext},createObject:function(a,c){var d,e=Object.create;return e?d=e(a):(b.__emptyFunc.prototype=a,d=new b.__emptyFunc),d.constructor=c,d},setContextStyle:function(a,b){for(p in b)"textBaseline"!=p&&p in a&&(b[p]||_.isNumber(b[p]))&&("globalAlpha"==p?a[p]*=b[p]:a[p]=b[p])},creatClass:function(a,c,d){if(!c||!a)return a;var e,f=c.prototype;return e=b.createObject(f,a),a.prototype=_.extend(e,a.prototype),a.superclass=b.createObject(f,c),d&&_.extend(e,d),a},debugMode:!1,log:function(){var a=this;if(a.debugMode){if("Error"in window)for(var b in arguments)throw new Error(arguments[b]);else if("console"in window&&console.log)for(var b in arguments)console.log(arguments[b]);return a}},initElement:function(a){"undefined"!=typeof FlashCanvas&&FlashCanvas.initElement&&FlashCanvas.initElement(a)},checkOpt:function(a){return a?a&&!a.context?(a.context={},a):a:{context:{}}},_UID:0,getUID:function(){return this._UID++},createId:function(a){var c=a.charCodeAt(a.length-1);return c>=48&&57>=c&&(a+="_"),a+b.getUID()},getType:function(b){return null==b?String(b):"object"==typeof b||"function"==typeof b?a[Object.prototype.toString.call(b)]||"object":typeof b},copy:function(a,b,c){if(_.isEmpty(b))return a;for(var d in b)(!c||a.hasOwnProperty(d)||void 0!==a[d])&&(a[d]=b[d]);return a},copyEvent:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}};return b},{requires:["canvax/animation/AnimationFrame","ontouchstart"in window?"canvax/library/hammer":"",window._?"":"canvax/library/underscore"]}),KISSY.add("canvax/core/propertyFactory",function(a,b){function c(a,d,e){function g(a,f){(!unwatchOne[a]||unwatchOne[a]&&"$"!==a.charAt(0))&&(d[a]=f);var g=b.getType(f);if("function"===g)unwatchOne[a]||n.push(a);else{if(-1!==_.indexOf(i,a)||"$"===a.charAt(0)&&!e[a])return n.push(a);var o,p;if("object"===g&&"function"==typeof f.get&&_.keys(f).length<=2){var q=f.set,r=f.get;o=function(b){var c=o.value,e=c;return arguments.length?(h||("function"==typeof q&&q.call(j,b),p!==b&&(p=b,c=o.value=d[a]=b,j.$fire&&j.$fire(a,c,e))),void 0):(b=o.value=d[a]=r.call(j),c!==b&&(p=void 0,j.$fire&&j.$fire(a,b,c)),b)},m.push(o)}else o=function(e){var f,i=o.value,k=i;if(!arguments.length)return"array"!==g&&"object"!==g||i.$model||(i.$parent=j,i=c(i,i),o.value=i),i;var l=b.getType(e);if(!h&&i!==e){"array"===l||"object"===l?(i=e.$model?e:c(e,e),f=i.$model):i=e,o.value=i,d[a]=f?f:i,f||j.$fire&&j.$fire(a,i,k),g!=l&&(g=l);var m=j;if(!j.$watch)for(;m.$parent;)m=m.$parent;m.$watch&&m.$watch.call(m,a,i,k)}},o.value=f,l.push(a);k[a]={set:o,get:o,enumerable:!0}}}var h=!0,i=a.$skipArray,j={},k={},l=[],m=[],n=_.keys(unwatchOne);d=d||{},e=e||{},i=_.isArray(i)?i.concat(n):n;for(var o in a)g(o,a[o]);return j=f(j,k,n),_.forEach(n,function(b){a[b]&&(j[b]="function"==typeof a[b]?function(){a[b].apply(this,arguments)}:a[b])}),j.$model=d,j.$accessor=k,j.hasOwnProperty=function(a){return a in j.$model},h=!1,j}function d(a,b,c){var d=a[b]&&a[b].set;return 3!==arguments.length?d():(d(c),void 0)}unwatchOne={$skipArray:0,$watch:1,$fire:2,$model:3,$accessor:4,$owner:5,path:6,$parent:7};var e=Object.defineProperty;try{e({},"_",{value:"x"});var f=Object.defineProperties}catch(g){"__defineGetter__"in Object&&(e=function(a,b,c){return"value"in c&&(a[b]=c.value),"get"in c&&a.__defineGetter__(b,c.get),"set"in c&&a.__defineSetter__(b,c.set),a},f=function(a,b){for(var c in b)b.hasOwnProperty(c)&&e(a,c,b[c]);return a})}return!f&&window.VBArray&&(window.execScript(["Function parseVB(code)","	ExecuteGlobal(code)","End Function"].join("\n"),"VBScript"),f=function(a,b,c){a=c.slice(0),a.push("hasOwnProperty");var e="VBClass"+setTimeout("1"),f={},g=[];g.push("Class "+e,"	Private [__data__], [__proxy__]","	Public Default Function [__const__](d, p)","		Set [__data__] = d: set [__proxy__] = p","		Set [__const__] = Me","	End Function"),_.forEach(a,function(a){f[a]!==!0&&(f[a]=!0,g.push("	Public ["+a+"]"))});for(var h in b)f[h]=!0,g.push("	Public Property Let ["+h+"](val)",'		Call [__proxy__]([__data__], "'+h+'", val)',"	End Property","	Public Property Set ["+h+"](val)",'		Call [__proxy__]([__data__], "'+h+'", val)',"	End Property","	Public Property Get ["+h+"]","	On Error Resume Next","		Set["+h+'] = [__proxy__]([__data__],"'+h+'")',"	If Err.Number <> 0 Then","		["+h+'] = [__proxy__]([__data__],"'+h+'")',"	End If","	On Error Goto 0","	End Property");return g.push("End Class"),g.push("Function "+e+"Factory(a, b)","	Dim o","	Set o = (New "+e+")(a, b)","	Set "+e+"Factory = o","End Function"),window.parseVB(g.join("\r\n")),window[e+"Factory"](b,d)}),c},{requires:["canvax/core/Base"]}),KISSY.add("canvax/display/Bitmap",function(a,b,c){var d=function(a){var b=this;b.type="bitmap",b.img=a.img||null,a=c.checkOpt(a),b._context={dx:a.context.dx,dy:a.context.dy,dWidth:a.context.dWidth||0,dHeight:a.context.dHeight||0},arguments.callee.superclass.constructor.apply(this,arguments)};return c.creatClass(d,b,{draw:function(a,b){if(this.img){var c=this.img;b.width&&b.height?void 0==b.dx||void 0==b.dy?a.drawImage(c,0,0,b.width,b.height):(!b.dWidth&&(b.dWidth=b.width),!b.dHeight&&(b.dHeight=b.height),a.drawImage(c,b.dx,b.dy,b.dWidth,b.dHeight,0,0,b.width,b.height)):a.drawImage(c,0,0)}}}),d},{requires:["canvax/display/Shape","canvax/core/Base"]}),KISSY.add("canvax/display/DisplayObject",function(a,b,c,d,e,f,g){var h=function(a){arguments.callee.superclass.constructor.apply(this,arguments);var b=this;a=e.checkOpt(a),b.id=a.id||null,b._transform=null,b._heartBeatNum=0,b.stage=null,b.parent=null,b._eventEnabled=!1,b.dragEnabled=!1,b._createContext(a);var c=e.createId(b.type);null==b.id&&(b.id=c),b.init.apply(b,arguments),this._updateTransform()};return e.creatClass(h,b,{init:function(){},_createContext:function(a){var b=this;b.context=null;var c=e.copy({width:0,height:0,x:0,y:0,scaleX:1,scaleY:1,scaleOrigin:{x:0,y:0},rotation:0,rotateOrigin:{x:0,y:0},visible:!0,cursor:"default",fillStyle:null,lineCap:null,lineJoin:null,lineWidth:null,miterLimit:null,shadowBlur:null,shadowColor:null,shadowOffsetX:null,shadowOffsetY:null,strokeStyle:null,globalAlpha:1,font:null,textAlign:"left",textBaseline:"top",arcScaleX_:null,arcScaleY_:null,lineScale_:null,globalCompositeOperation:null},a.context,!0);b._context&&(c=_.extend(c,b._context)),b._notWatch=!1,c.$owner=b,c.$watch=function(a,b,c){var d=["x","y","scaleX","scaleY","rotation","scaleOrigin","rotateOrigin"];_.indexOf(d,a)>=0&&this.$owner._updateTransform(),this.$owner._notWatch||(this.$owner.$watch&&this.$owner.$watch(a,b,c),this.$owner.heartBeat({convertType:"context",shape:this.$owner,name:a,value:b,preValue:c}))},b.context=g(c)},clone:function(a){var b={id:this.id,context:this.context.$model};this.img&&(b.img=this.img);var c=new this.constructor(b);return a||(c.id=e.createId(c.type)),c},heartBeat:function(a){var b=this.getStage();b&&(this._heartBeatNum++,b.heartBeat&&b.heartBeat(a))},getCurrentWidth:function(){return Math.abs(this.context.width*this.context.scaleX)},getCurrentHeight:function(){return Math.abs(this.context.height*this.context.scaleY)},getStage:function(){if(this.stage)return this.stage;var a=this;if("stage"!=a.type){for(;a.parent&&(a=a.parent,"stage"!=a.type););if("stage"!==a.type)return!1}return this.stage=a,a},localToGlobal:function(a,b){!a&&(a=new d(0,0));var e=this.getConcatenatedMatrix(b);if(null==e)return d(0,0);var f=new c(1,0,0,1,a.x,a.y);return f.concat(e),new d(f.tx,f.ty)},globalToLocal:function(a,b){!a&&(a=new d(0,0));var e=this.getConcatenatedMatrix(b);if(null==e)return new d(0,0);e.invert();var f=new c(1,0,0,1,a.x,a.y);return f.concat(e),new d(f.tx,f.ty)},localToTarget:function(a,b){var c=localToGlobal(a);return b.globalToLocal(c)},getConcatenatedMatrix:function(a){for(var b=new c,d=this;null!=d&&(b.concat(d._transform),!(!d.parent||a&&d.parent&&d.parent==a||d.parent&&"stage"==d.parent.type));d=d.parent);return b},setEventEnable:function(a){return _.isBoolean(a)?(this._eventEnabled=a,!0):!1},getIndex:function(){return this.parent?_.indexOf(this.parent.children,this):void 0},toBack:function(a){if(this.parent){var b=this.getIndex(),c=0;if(_.isNumber(a)){if(0==a)return;c=b-a}var d=this.parent.children.splice(b,1)[0];0>c&&(c=0),this.parent.addChildAt(d,c)}},toFront:function(a){if(this.parent){var b=this.getIndex(),c=this.parent.children.length,d=c;if(_.isNumber(a)){if(0==a)return;d=b+a+1}var e=this.parent.children.splice(b,1)[0];d>c&&(d=c),this.parent.addChildAt(e,d-1)}},_transformHander:function(a){var b=this._transform;b||(b=this._updateTransform()),a.transform.apply(a,b.toArray())},_updateTransform:function(){var a=new c;if(a.identity(),1!==this.context.scaleX||1!==this.context.scaleY){var b=new d(this.context.scaleOrigin);(b.x||b.y)&&a.translate(-b.x,-b.y),a.scale(this.context.scaleX,this.context.scaleY),(b.x||b.y)&&a.translate(b.x,b.y)}var e=this.context.rotation;if(e){var b=new d(this.context.rotateOrigin);(b.x||b.y)&&a.translate(-b.x,-b.y),a.rotate(e%360*Math.PI/180),(b.x||b.y)&&a.translate(b.x,b.y)}return(0!=this.context.x||0!=this.context.y)&&a.translate(this.context.x,this.context.y),this._transform=a,a},getRect:function(a){return{x:0,y:0,width:a.width,height:a.height}},getChildInPoint:function(a){var b;"stage"!=this.type&&this.parent&&"stage"!=this.parent.type&&(a=this.parent.globalToLocal(a));var c=a.x,d=a.y;if(this._notWatch=!0,this._transform){var e=this._transform.clone().invert(),g=[c,d];e.mulVector(g,[c,d]),c=g[0],d=g[1]}var h=this._rect=this.getRect(this.context);return h?(!this.context.width&&h.width&&(this.context.width=h.width),!this.context.height&&h.height&&(this.context.height=h.height),h.width&&h.height?(b=c>=h.x&&c<=h.x+h.width&&d>=h.y&&d<=h.y+h.height?f.isInside(this,c,d):!1,this._notWatch=!1,b):!1):!1},_render:function(a){!this.context.visible||this.context.globalAlpha<=0||(a.save(),this._transformHander(a),"text"!=this.type&&e.setContextStyle(a,this.context.$model),this.render(a),a.restore())},render:function(){},remove:function(){this.parent&&this.parent.removeChild(this)},destroy:function(){this.remove(),this.context=null,delete this.context},toString:function(){var a;if(!this.parent)return this.id+"(stage)";for(var b=this;null!=b;b=b.parent){var c=b.id+"("+b.type+")";if(a=null==a?c:c+"-->"+a,b==b.parent||!b.parent)break}return a}}),h},{requires:["canvax/event/EventDispatcher","canvax/geom/Matrix","canvax/display/Point","canvax/core/Base","canvax/geom/HitTestPoint","canvax/core/propertyFactory"]}),KISSY.add("canvax/display/DisplayObjectContainer",function(a,b,c){return DisplayObjectContainer=function(){var a=this;a.children=[],a.mouseChildren=[],arguments.callee.superclass.constructor.apply(this,arguments),a._eventEnabled=!0},b.creatClass(DisplayObjectContainer,c,{addChild:function(a){return a?-1!=this.getChildIndex(a)?(a.parent=this,a):(a.parent&&a.parent.removeChild(a),this.children.push(a),a.parent=this,this.heartBeat&&this.heartBeat({convertType:"children",target:a,src:this}),this._afterAddChild&&this._afterAddChild(a),a):void 0},addChildAt:function(a,b){return-1!=this.getChildIndex(a)?(a.parent=this,a):(a.parent&&a.parent.removeChild(a),this.children.splice(b,0,a),a.parent=this,this.heartBeat&&this.heartBeat({convertType:"children",target:a,src:this}),this._afterAddChild&&this._afterAddChild(a,b),a)},removeChild:function(a){return this.removeChildAt(_.indexOf(this.children,a))},removeChildAt:function(a){if(0>a||a>this.children.length-1)return!1;var b=this.children[a];return null!=b&&(b.parent=null),this.children.splice(a,1),this.heartBeat&&this.heartBeat({convertType:"children",target:b,src:this}),this._afterDelChild&&this._afterDelChild(b,a),b},removeChildById:function(a){for(var b=0,c=this.children.length;c>b;b++)if(this.children[b].id==a)return this.removeChildAt(b);return!1},removeAllChildren:function(){for(;this.children.length>0;)this.removeChildAt(0)},destroy:function(){this.parent&&this.parent.removeChild(this),_.each(this.children,function(a){a.destroy()})},getChildById:function(a,b){if(b)return null;for(var c=0,d=this.children.length;d>c;c++)if(this.children[c].id==a)return this.children[c];return null},getChildAt:function(a){return 0>a||a>this.children.length-1?null:this.children[a]},getChildIndex:function(a){return _.indexOf(this.children,a)},setChildIndex:function(a,b){if(a.parent==this){var c=_.indexOf(this.children,a);b!=c&&(this.children.splice(c,1),this.children.splice(b,0,a))}},contains:function(a){return-1!=this.getChildIndex(a)},getNumChildren:function(){return this.children.length},getObjectsUnderPoint:function(a,b){for(var c=[],d=this.children.length-1;d>=0;d--){var e=this.children[d];if(null!=e&&(e._eventEnabled||e.dragEnabled)&&e.context.visible)if(e instanceof DisplayObjectContainer){if(e.mouseChildren&&e.getNumChildren()>0){var f=e.getObjectsUnderPoint(a);f.length>0&&(c=c.concat(f))}}else if(e.getChildInPoint(a)&&(c.push(e),void 0!=b&&!isNaN(b)&&c.length==b))return c}return c},render:function(a){for(var b=0,c=this.children.length;c>b;b++)this.children[b]._render(a)}}),DisplayObjectContainer},{requires:["canvax/core/Base","canvax/display/DisplayObject","canvax/display/Point"]}),KISSY.add("canvax/display/Movieclip",function(a,b,c){var d=function(a){var b=this;a=c.checkOpt(a),b.type="movieclip",b.currentFrame=0,b.autoPlay=a.autoPlay||!1,b.repeat=a.repeat||0,b.overPlay=a.overPlay||!1,b._frameRate=c.mainFrameRate,b._speedTime=parseInt(1e3/b._frameRate),b._preRenderTime=0,b._context={},arguments.callee.superclass.constructor.apply(this,[a])};return c.creatClass(d,b,{init:function(){},getStatus:function(){return this.autoPlay},getFrameRate:function(){return this._frameRate},setFrameRate:function(a){var b=this;b._frameRate!=a&&(b._frameRate=a,b._speedTime=parseInt(1e3/b._frameRate))},afterAddChild:function(a,b){1!=this.children.length&&void 0!=b&&b<=this.currentFrame&&this.currentFrame++},afterDelChild:function(a,b){this.currentFrame;b<this.currentFrame&&this.currentFrame--,this.currentFrame>=this.children.length&&this.children.length>0&&(this.currentFrame=this.children.length-1)},_goto:function(a){var b=this.children.length;a>=b&&(a%=b),0>a&&(a=this.children.length-1-Math.abs(a)%b),this.currentFrame=a},gotoAndStop:function(a){return this._goto(a),this.autoPlay?(this.autoPlay=!1,void 0):(this._preRenderTime=0,this.getStage().heartBeat(),void 0)},stop:function(){this.autoPlay&&(this.autoPlay=!1)},gotoAndPlay:function(a){this._goto(a),this.play()},play:function(){if(!this.autoPlay){this.autoPlay=!0;var a=this.getStage().parent;a._heartBeat||0!=a._taskList.length||a.__startEnter(),this._push2TaskList(),this._preRenderTime=(new Date).getTime()}},_push2TaskList:function(){this._enterInCanvax||(this.getStage().parent._taskList.push(this),this._enterInCanvax=!0)},_enterInCanvax:!1,__enterFrame:function(){var a=this;c.now-a._preRenderTime>=a._speedTime&&a.getStage().heartBeat()},next:function(){var a=this;a.autoPlay||a.gotoAndStop(a._next())},pre:function(){var a=this;a.autoPlay||a.gotoAndStop(a._pre())},_next:function(){return this.currentFrame>=this.children.length-1?this.currentFrame=0:this.currentFrame++,this.currentFrame},_pre:function(){return 0==this.currentFrame?this.currentFrame=this.children.length-1:this.currentFrame--,this.currentFrame},render:function(a){if(this.overPlay)for(var b=0;b<=this.currentFrame;b++)this.getChildAt(b)._render(a);else this.getChildAt(this.currentFrame)._render(a);if(1==this.children.length&&(this.autoPlay=!1),this.currentFrame==this.getNumChildren()-1&&(this.repeat||(this.stop(),this.hasEvent("end")&&this.fire("end")),_.isNumber(this.repeat)&&this.repeat>0&&this.repeat--),this.autoPlay)c.now-this._preRenderTime>=this._speedTime&&(this._preRenderTime=c.now,this._next()),this._push2TaskList();else if(this._enterInCanvax){this._enterInCanvax=!1;var d=this.getStage().parent._taskList;d.splice(_.indexOf(d,this),1)}}}),d},{requires:["canvax/display/DisplayObjectContainer","canvax/core/Base"]}),KISSY.add("canvax/display/Point",function(){var a=function(a,b){if(1!=arguments.length||"object"!=typeof arguments[0])a||(a=0),b||(b=0),this.x=1*a,this.y=1*b;else{var c=arguments[0];if("x"in c&&"y"in c)this.x=1*c.x,this.y=1*c.y;else{var d=0;for(var e in c){if(0!=d){this.y=1*c[e];break}this.x=1*c[e],d++}}}};return a}),KISSY.add("canvax/display/Shape",function(a,b,c){var d=function(a){var b=this;b._hoverable=!1,b._clickable=!1,b._hoverClass=!1,b._dragDuplicate=null,b.type=b.type||"shape",a.draw&&(b.draw=a.draw),arguments.callee.superclass.constructor.apply(this,arguments),b._rect=null};return c.creatClass(d,b,{init:function(){},draw:function(){},drawEnd:function(a){if(!this._hasFillAndStroke){var b=this.context;"stroke"!=this.drawTypeOnly&&a.closePath(),b.strokeStyle&&b.lineWidth&&a.stroke(),b.fillStyle&&"stroke"!=this.drawTypeOnly&&a.fill()}},render:function(){var a=this,b=a.context,c=a.getStage().context2D;"shape"==a.context.type?a.draw.apply(a):a.draw&&(c.beginPath(),a.draw(c,b),a.drawEnd(c))},dashedLineTo:function(a,b,c,d,e,f){f="undefined"==typeof f?5:f,f=Math.max(f,this.context.lineWidth);for(var g=d-b,h=e-c,i=Math.floor(Math.sqrt(g*g+h*h)/f),j=0;i>j;++j)a[j%2===0?"moveTo":"lineTo"](b+g/i*j,c+h/i*j)},getRectFormPointList:function(a){for(var b=Number.MAX_VALUE,c=Number.MIN_VALUE,d=Number.MAX_VALUE,e=Number.MIN_VALUE,f=a.pointList.$model,g=0,h=f.length;h>g;g++)f[g][0]<b&&(b=f[g][0]),f[g][0]>c&&(c=f[g][0]),f[g][1]<d&&(d=f[g][1]),f[g][1]>e&&(e=f[g][1]);var i;return i=a.strokeStyle||a.fillStyle?a.lineWidth||1:0,{x:Math.round(b-i/2),y:Math.round(d-i/2),width:c-b+i,height:e-d+i}}}),d},{requires:["canvax/display/DisplayObject","canvax/core/Base"]}),KISSY.add("canvax/display/Sprite",function(a,b,c){var d=function(){var a=this;a.type="sprite",arguments.callee.superclass.constructor.apply(this,arguments)};return c.creatClass(d,b,{init:function(){}}),d},{requires:["canvax/display/DisplayObjectContainer","canvax/core/Base"]}),KISSY.add("canvax/display/Stage",function(a,b,c){var d=function(){var a=this;a.type="stage",a.context2D=null,a.stageRending=!1,a._isReady=!1,arguments.callee.superclass.constructor.apply(this,arguments)};return c.creatClass(d,b,{init:function(){},initStage:function(a,b,d){var e=this;e.context2D=a,e.context.width=b,e.context.height=d,e.context.scaleX=c._devicePixelRatio,e.context.scaleY=c._devicePixelRatio,e._isReady=!0},render:function(a){this.stageRending=!0,this.clear(),d.superclass.render.call(this,a),this.stageRending=!1},heartBeat:function(a){this._isReady&&(a||(a={}),a.stage=this,this.parent&&this.parent.heartBeat(a))},clear:function(a,b,c,d){arguments.length>=4?this.context2D.clearRect(a,b,c,d):this.context2D.clearRect(0,0,this.context2D.canvas.width,this.context2D.canvas.height)}}),d},{requires:["canvax/display/DisplayObjectContainer","canvax/core/Base"]}),KISSY.add("canvax/display/Text",function(a,b,c){var d=function(a,b){var d=this;d.type="text",d._reNewline=/\r?\n/,d.fontProperts=["fontStyle","fontVariant","fontWeight","fontSize","fontFamily"],b=c.checkOpt(b),d._context={fontSize:b.context.fontSize||13,fontWeight:b.context.fontWeight||"normal",fontFamily:b.context.fontFamily||"微软雅黑",textDecoration:b.context.textDecoration,fillStyle:b.context.fontColor||b.context.fillStyle||"blank",lineHeight:b.context.lineHeight||1.3,backgroundColor:b.context.backgroundColor,textBackgroundColor:b.context.textBackgroundColor},d._context.font=d._getFontDeclaration(),d.text=a.toString(),arguments.callee.superclass.constructor.apply(this,[b])};return c.creatClass(d,b,{$watch:function(a){a in this.fontProperts&&(this._notWatch=!1,this.context.font=this._getFontDeclaration())},init:function(){},render:function(a){var b=this._getTextLines();this.context.width=this._getTextWidth(a,b),this.context.height=this._getTextHeight(a,b);for(p in this.context.$model)p in a&&"textBaseline"!=p&&this.context.$model[p]&&(a[p]=this.context.$model[p]);this.clipTo&&this.clipContext(this,a),this._renderTextBackground(a,b),this._renderText(a,b),this.clipTo&&a.restore()},resetText:function(a){this.text=a.toString(),this.heartBeat()},getTextWidth:function(){var a=0;return c._pixelCtx.save(),c._pixelCtx.font=this.context.font,a=this._getTextWidth(c._pixelCtx,this._getTextLines()),c._pixelCtx.restore(),a},getTextHeight:function(){return this._getTextHeight(c._pixelCtx,this._getTextLines())},_getTextLines:function(){return this.text.split(this._reNewline)},_renderText:function(a,b){a.save(),this._setShadow(a),this._renderTextFill(a,b),this._renderTextStroke(a,b),this._removeShadow(a),a.restore()},_getFontDeclaration:function(){var a=this,b=[];return _.each(this.fontProperts,function(c){var d=a._context[c];"fontSize"==c&&(d=parseFloat(d)+"px"),d&&b.push(d)}),b.join(" ")},_renderTextFill:function(a,b){if(this.context.fillStyle){this._boundaries=[];for(var c=0,d=0,e=b.length;e>d;d++){var f=this._getHeightOfLine(a,d,b);c+=f,this._renderTextLine("fillText",a,b[d],0,this._getTopOffset()+c,d)}}},_renderTextStroke:function(a,b){if(this.context.strokeStyle||this._skipFillStrokeCheck){var c=0;a.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),supportsLineDash&&a.setLineDash(this.strokeDashArray)),a.beginPath();for(var d=0,e=b.length;e>d;d++){var f=this._getHeightOfLine(a,d,b);c+=f,this._renderTextLine("strokeText",a,b[d],0,this._getTopOffset()+c,d)}a.closePath(),a.restore()}},_renderTextLine:function(a,b,c,d,e,f){if(e-=this.context.fontSize/4,"justify"!==this.context.textAlign)return this._renderChars(a,b,c,d,e,f),void 0;var g=b.measureText(c).width,h=this.context.width;if(h>g)for(var i=c.split(/\s+/),j=b.measureText(c.replace(/\s+/g,"")).width,k=h-j,l=i.length-1,m=k/l,n=0,o=0,p=i.length;p>o;o++)this._renderChars(a,b,i[o],d+n,e,f),n+=b.measureText(i[o]).width+m;else this._renderChars(a,b,c,d,e,f)},_renderChars:function(a,b,c,d,e){b[a](c,0,e)},_setShadow:function(a){this.shadow&&(a.shadowColor="red",a.shadowBlur=1,a.shadowOffsetX=1,a.shadowOffsetY=1)},_removeShadow:function(a){a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0},_getHeightOfLine:function(){return this.context.fontSize*this.context.lineHeight},_getTextWidth:function(a,b){for(var c=a.measureText(b[0]||"|").width,d=1,e=b.length;e>d;d++){var f=a.measureText(b[d]).width;f>c&&(c=f)}return c},_getTextHeight:function(a,b){return this.context.fontSize*b.length*this.context.lineHeight},clipContext:function(a,b){b.save(),b.beginPath(),a.clipTo(b),b.clip()},_renderTextBackground:function(a,b){this._renderTextBoxBackground(a),this._renderTextLinesBackground(a,b)},_renderTextBoxBackground:function(a){this.context.backgroundColor&&(a.save(),a.fillStyle=this.context.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.context.width,this.context.height),a.restore())},_renderTextLinesBackground:function(a,b){if(this.context.textBackgroundColor){a.save(),a.fillStyle=this.context.textBackgroundColor;for(var c=0,d=b.length;d>c;c++)if(""!==b[c]){var e=this._getLineWidth(a,b[c]),f=this._getLineLeftOffset(e);a.fillRect(this._getLeftOffset()+f,this._getTopOffset()+c*this.context.fontSize*this.context.lineHeight,e,this.context.fontSize*this.context.lineHeight)}a.restore()}},_getLineWidth:function(a,b){return"justify"===this.context.textAlign?this.context.width:a.measureText(b).width},_getLineLeftOffset:function(a){return"center"===this.context.textAlign?(this.context.width-a)/2:"right"===this.context.textAlign?this.context.width-a:0},_getLeftOffset:function(){var a=0;switch(this.context.textAlign){case"left":a=0;break;case"center":a=-this.context.width/2;break;case"right":a=-this.context.width}return a},_getTopOffset:function(){var a=0;switch(this.context.textBaseline){case"top":a=0;break;case"middle":a=-this.context.height/2;break;case"bottom":a=-this.context.height}return a}}),d},{requires:["canvax/display/DisplayObject","canvax/core/Base"]}),KISSY.add("canvax/event/CanvaxEvent",function(a,b,c){var d=function(a,c,d){b.call(this,a,c,d),this.mouseX=0,this.mouseY=0};c.creatClass(d,b,{toString:function(){return"[CanvaxEvent type="+this.type+", mouseX="+this.mouseX+", mouseY="+this.mouseY+"]"}}),d.EVENTS=["click","mousedown","mousemove","mouseup","mouseout"];var e=function(a,b){return document[a]?function(b,c,d){if(b.length)for(var e=0;e<b.length;e++)arguments.callee(b[e],c,d);else b[a](c,d,!1)}:function(a,c,d){if(a.length)for(var e=0;e<a.length;e++)arguments.callee(a[e],c,d);else a[b]("on"+c,function(){return d.call(a,window.event)})}};return d.addEvent=e("addEventListener","attachEvent"),d.removeEvent=e("removeEventListener","detachEvent"),d.stopDefault=function(a){return a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1,!1},d},{requires:["canvax/event/EventBase","canvax/core/Base"]}),KISSY.add("canvax/event/EventBase",function(){var a=function(a,b,c){this.type=a,this.target=null,this.currentTarget=null,this.params=null,this.bubbles=void 0!=b?b:!1,this.cancelable=void 0!=c?c:!1,this._stopPropagation=!1};return a.prototype.stopPropagation=function(){this._stopPropagation=!0},a.prototype.preventDefault=function(){},a.prototype.clone=function(){return Base.copy(this)},a.prototype.dispose=function(){delete this.type,delete this.target,delete this.currentTarget,delete this.params},a.prototype.toString=function(){return"[EventBase type="+this.type+"]"},a},{requires:["canvax/core/Base"]}),KISSY.add("canvax/event/EventDispatcher",function(a,b,c){var d=function(){arguments.callee.superclass.constructor.call(this,name)};return b.creatClass(d,c,{on:function(a,b){return this._addEventListener(a,b),this},addEventListener:function(a,b){return this._addEventListener(a,b),this},un:function(a,b){return this._removeEventListener(a,b),this},removeEventListener:function(a,b){return this._removeEventListener(a,b),this},removeEventListenerByType:function(a){return this._removeEventListenerByType(a),this},removeAllEventListeners:function(){return this._removeAllEventListeners(),this},fire:function(a){return _.isString(a)&&(a={type:a}),this.dispatchEvent(a),this},dispatchEvent:function(a){if("mouseover"!=a.type){if(this._dispatchEvent(a),"mouseout"==a.type&&this._hoverClass){var b=this.getStage().parent;this._hoverClass=!1,b._hoverStage.removeChildById(this.id)}return this}var c=this._heartBeatNum;if(this._dispatchEvent(a),c!=this._heartBeatNum){this._hoverClass=!0;var b=this.getStage().parent;_.values(b.convertStages[this.getStage().id].convertShapes).length>1||(delete b.convertStages[this.getStage().id],this._heart=!1);var d=this.clone(!0);d._transform=this.getConcatenatedMatrix(),b._hoverStage.addChild(d)}},hasEvent:function(a){return this._hasEventListener(a)},hasEventListener:function(a){return this._hasEventListener(a)},hover:function(a,b){return this.on("mouseover",a),this.on("mouseout",b),this},once:function(a,b){return this.on(a,function(){b.apply(this,arguments),this.un(a,arguments.callee)}),this}}),d},{requires:["canvax/core/Base","canvax/event/EventManager"]}),KISSY.add("canvax/event/EventManager",function(){var a=function(){this._eventMap={}};return a.prototype={_addEventListener:function(a,b){if("function"!=typeof b)return!1;var c=!0,d=this;return _.each(a.split(" "),function(a){var e=d._eventMap[a];return e?-1==_.indexOf(e,b)?(e.push(b),d._eventEnabled=!0,!0):(c=!1,void 0):(e=d._eventMap[a]=[],e.push(b),d._eventEnabled=!0,!0)}),c},_removeEventListener:function(a,b){if(1==arguments.length)return this.removeEventListenerByType(a);var c=this._eventMap[a];if(!c)return!1;for(var d=0;d<c.length;d++){var e=c[d];if(e===b)return c.splice(d,1),0==c.length&&(delete this._eventMap[a],_.isEmpty(this._eventMap)&&(this._eventEnabled=!1)),!0}return!1},_removeEventListenerByType:function(a){var b=this._eventMap[a];return b?!1:(delete this._eventMap[a],_.isEmpty(this._eventMap)&&(this._eventEnabled=!1),!0)},_removeAllEventListeners:function(){this._eventMap={},this._eventEnabled=!1},_dispatchEvent:function(a){var b=this._eventMap[a.type];if(b){a.target||(a.target=this),b=b.slice();for(var c=0;c<b.length;c++){var d=b[c];"function"==typeof d&&d.call(this,a)}}return a._stopPropagation||this.parent&&(a.currentTarget=this.parent,this.parent._dispatchEvent(a)),!0},_hasEventListener:function(a){var b=this._eventMap[a];return null!=b&&b.length>0}},a},{requires:[]}),KISSY.add("canvax/geom/HitTestPoint",function(a,b,c){function d(a,c,d){if("bitmap"==a.type)return!0;if(!a||!a.type)return!1;var h=a.type,i=e(h,a,c,d);if("undefined"!=typeof i)return i;if("beziercurve"!=h&&a.buildPath&&b._pixelCtx.isPointInPath)return f(a,b._pixelCtx,c,d);if(b._pixelCtx.getImageData)return g(a,c,d);switch(h){case"heart":return!0;case"droplet":return!0;case"ellipse":return!0;default:return!1}}function e(a,b,c,d){switch(a){case"line":return j(b.context,c,d);case"brokenLine":return k(b,c,d);case"text":return!0;case"ring":return l(b,c,d);case"rect":return!0;case"circle":return n(b,c,d);case"ellipse":return p(b,c,d);case"sector":return o(b,c,d);case"path":return r(b,c,d);case"polygon":case"star":case"isogon":return q(b,c,d);case"image":return!0}}function f(a,b,c,d){var b=a.context;return b.beginPath(),a.buildPath(b,b),b.closePath(),b.isPointInPath(c,d)}function g(a,c,d){var e=a.context,f=b._pixelCtx;f.save(),f.beginPath(),b.setContextStyle(f,e.$model),f.transform.apply(f,a.getConcatenatedMatrix().toArray()),f.clearRect(a._rect.x-10,a._rect.y-10,a._rect.width+20,a._rect.height+20),a.draw(f,e),a.drawEnd(f),f.closePath(),f.restore();var g=a.getConcatenatedMatrix();if(g){var i=g.clone(),j=[c,d];i.mulVector(j,[c,d,1]),c=j[0],d=j[1]}return h(f,c,d)}function h(a,b,c,d){var e;"undefined"!=typeof d?(d=Math.floor((d||1)/2),e=a.getImageData(b-d,c-d,d+d,d+d).data):e=a.getImageData(b,c,1,1).data;for(var f=e.length;f--;)if(0!==e[f])return!0;return!1}function i(a,b,c){return!d(a,b,c)}function j(a,b,c){var d=a.xStart,e=a.yStart,f=a.xEnd,g=a.yEnd,h=a.lineWidth,i=0,j=d;if(d===f)return Math.abs(b-d)<=h/2;i=(e-g)/(d-f),j=(d*g-f*e)/(d-f);var k=(i*b-c+j)*(i*b-c+j)/(i*i+1);return h/2*h/2>=k}function k(a,b,c){for(var d,e=a.context,f=e.pointList.$model,g=!1,h=0,i=f.length-1;i>h&&(d={xStart:f[h][0],yStart:f[h][1],xEnd:f[h+1][0],yEnd:f[h+1][1],lineWidth:e.lineWidth},!m({x:Math.min(d.xStart,d.xEnd)-d.lineWidth,y:Math.min(d.yStart,d.yEnd)-d.lineWidth,width:Math.abs(d.xStart-d.xEnd)+d.lineWidth,height:Math.abs(d.yStart-d.yEnd)+d.lineWidth},b,c)||!(g=j(d,b,c)));h++);return g}function l(a,b,c){var d=a.context;return n(a,b,c)&&!n(a,b,c,d.r0||0)?!0:!1}function m(a,b,c){return b>=a.x&&b<=a.x+a.width&&c>=a.y&&c<=a.y+a.height?!0:!1}function n(a,b,c,d){var e=a.context;return!d&&(d=e.r),d*d>b*b+c*c}function o(a,b,d){var e=a.context;if(!n(a,b,d)||e.r0>0&&n(a,b,d,e.r0))return!1;var f=c.degreeTo360(e.startAngle),g=c.degreeTo360(e.endAngle),h=c.degreeTo360(Math.atan2(d,b)/Math.PI*180%360),i=!0;(f>g&&!e.clockwise||g>f&&e.clockwise)&&(i=!1);var j=[Math.min(f,g),Math.max(f,g)],k=h>j[0]&&h<j[1];return k&&i||!k&&!i}function p(a,b,c){var d,e=a.context,f={x:0,y:0},g=e.hr,h=e.vr,i={x:b,y:c};
return i.x-=f.x,i.y-=f.y,i.x*=i.x,i.y*=i.y,g*=g,h*=h,d=h*i.x+g*i.y-g*h,0>d}function q(a,b,c){var d,e,f,g=a.context?a.context:a,h=g.pointList.$model||g.pointList,i=h.length,j=!1,k=!0;for(d=0;i>d;++d)if(h[d][0]==b&&h[d][1]==c){k=!1,j=!0;break}if(k)for(k=!1,j=!1,d=0,e=i-1;i>d;e=d++)if(h[d][1]<c&&c<h[e][1]||h[e][1]<c&&c<h[d][1]){if(b<=h[d][0]||b<=h[e][0])if(f=(c-h[d][1])*(h[e][0]-h[d][0])/(h[e][1]-h[d][1])+h[d][0],f>b)j=!j;else if(b==f){j=!0;break}}else if(c==h[d][1]){if(b<h[d][0]){h[d][1]>h[e][1]?--c:++c;break}}else if(h[d][1]==h[e][1]&&c==h[d][1]&&(h[d][0]<b&&b<h[e][0]||h[e][0]<b&&b<h[d][0])){j=!0;break}return j}function r(a,b,c){for(var d=a.context,e=d.$pointList||d.pointList.$model,f=!1,g=0,h=e.length;h>g&&!(f=q({pointList:e[g]},b,c));g++);return f}function s(a,c){b._pixelCtx.save(),c&&(b._pixelCtx.font=c);var d=b._pixelCtx.measureText(a).width;return b._pixelCtx.restore(),d}var t={};return t={isInside:d,isOutside:i,getTextWidth:s}},{requires:["canvax/core/Base","canvax/geom/Math"]}),KISSY.add("canvax/geom/Math",function(){function a(a,b){return a=(b?a*g:a).toFixed(4),"undefined"==typeof f.sin[a]&&(f.sin[a]=Math.sin(a)),f.sin[a]}function b(a,b){return a=(b?a*g:a).toFixed(4),"undefined"==typeof f.cos[a]&&(f.cos[a]=Math.cos(a)),f.cos[a]}function c(a){return a*g}function d(a){return a/g}function e(a){var b=Math.abs(360+Math.round(a)%360)%360;return 0==b&&0!==a&&(b=360),b}var f={sin:{},cos:{}},g=Math.PI/180;return{PI:Math.PI,sin:a,cos:b,degreeToRadian:c,radianToDegree:d,degreeTo360:e}},{requires:[]}),KISSY.add("canvax/geom/Matrix",function(a,b){var c=function(a,b,c,d,e,f){this.a=void 0!=a?a:1,this.b=void 0!=b?b:0,this.c=void 0!=c?c:0,this.d=void 0!=d?d:1,this.tx=void 0!=e?e:0,this.ty=void 0!=f?f:0};return b.creatClass(c,function(){},{concat:function(a){var b=this.a,c=this.c,d=this.tx;return this.a=b*a.a+this.b*a.c,this.b=b*a.b+this.b*a.d,this.c=c*a.a+this.d*a.c,this.d=c*a.b+this.d*a.d,this.tx=d*a.a+this.ty*a.c+a.tx,this.ty=d*a.b+this.ty*a.d+a.ty,this},concatTransform:function(a,b,d,e,f){var g=1,h=0;if(f%360){var i=f*Math.PI/180;g=Math.cos(i),h=Math.sin(i)}return this.concat(new c(g*d,h*d,-h*e,g*e,a,b)),this},rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=this.a,e=this.c,f=this.tx;if(a>0)this.a=d*b-this.b*c,this.b=d*c+this.b*b,this.c=e*b-this.d*c,this.d=e*c+this.d*b,this.tx=f*b-this.ty*c,this.ty=f*c+this.ty*b;else{var g=Math.sin(Math.abs(a)),h=Math.cos(Math.abs(a));this.a=d*h+this.b*g,this.b=-d*g+this.b*h,this.c=e*h+this.d*g,this.d=-e*g+h*this.d,this.tx=h*f+g*this.ty,this.ty=h*this.ty-g*f}return this},scale:function(a,b){return this.a*=a,this.d*=b,this.tx*=a,this.ty*=b,this},translate:function(a,b){return this.tx+=a,this.ty+=b,this},identity:function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},invert:function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.tx,f=a*d-b*c;return this.a=d/f,this.b=-b/f,this.c=-c/f,this.d=a/f,this.tx=(c*this.ty-d*e)/f,this.ty=-(a*this.ty-b*e)/f,this},clone:function(){return new c(this.a,this.b,this.c,this.d,this.tx,this.ty)},toString:function(){return"(a="+this.a+", b="+this.b+", c="+this.c+", d="+this.d+", tx="+this.tx+", ty="+this.ty+")"},toArray:function(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]},mulVector:function(a,b){var c=this.a,d=this.c,e=this.tx,f=this.b,g=this.d,h=this.ty;return a[0]=b[0]*c+b[1]*d+e,a[1]=b[0]*f+b[1]*g+h,a}}),c},{requires:["canvax/core/Base"]}),KISSY.add("canvax/geom/smoothSpline",function(a,b){function c(a,b,c,d,e,f,g){var h=.5*(c-a),i=.5*(d-b);return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b}return function(a,d){for(var e=a.length,f=[],g=0,h=new b(a[0]),i=null,j=1;e>j;j++)i=new b(a[j]),g+=h.distance(i),h=i;h=null,i=null;var k=g/5;k=e>k?e:k;for(var j=0;k>j;j++){var l,m,n,o=j/(k-1)*(d?e:e-1),p=Math.floor(o),q=o-p,r=a[p%e];d?(l=a[(p-1+e)%e],m=a[(p+1)%e],n=a[(p+2)%e]):(l=a[0===p?p:p-1],m=a[p>e-2?e-1:p+1],n=a[p>e-3?e-1:p+2]);var s=q*q,t=q*s;f.push([c(l[0],r[0],m[0],n[0],q,s,t),c(l[1],r[1],m[1],n[1],q,s,t)])}return f}},{requires:["canvax/geom/Vector"]}),KISSY.add("canvax/index",function(a,b,c,d,e,f,g,h,i,j,k){var l=function(a){this.type="canvax",this.el=a.el||null,this.preventDefault=!0,a.preventDefault===!1&&(this.preventDefault=!1),this.el.html("<div class='' style='width:"+this.el.width()+"px;height:"+this.el.height()+"px'></div>"),this.el=this.el.all("div"),this.rootOffset=this.el.offset(),this.curPoints=[new h(0,0)],this.curPointsTarget=[],this.convertStages={},this._heartBeat=!1,this._speedTime=parseInt(1e3/b.mainFrameRate),this._preRenderTime=0,this._taskList=[],this._hoverStage=null,this._pixelCtx=null,this._isReady=!1,this._touching=!1,this._draging=!1,this._cursor="default",arguments.callee.superclass.constructor.apply(this,arguments)};return b.creatClass(l,d,{init:function(){this.context.width=this.el.width(),this.context.height=this.el.height(),this._creatHoverStage(),this._initEvent(),this.createPixelContext(),this._isReady=!0},reSet:function(){this.rootOffset=this.el.offset()},_creatHoverStage:function(){this._hoverStage=new e({id:"activCanvas"+(new Date).getTime(),context:{width:this.context.width,height:this.context.height}}),this.addChild(this._hoverStage)},createPixelContext:function(){var c=null;c=0==a.all("#_pixelCanvas").length?b._createCanvas("_pixelCanvas",this.context.width,this.context.height):a.all("#_pixelCanvas")[0],document.body.appendChild(c),b.initElement(c),b.canvasSupport()?c.style.display="none":(c.style.zIndex=-1,c.style.position="absolute",c.style.left=-this.context.width+"px",c.style.top=-this.context.height+"px",c.style.visibility="hidden"),b._pixelCtx=c.getContext("2d")},_initEvent:function(){var a=this,b=0;if(window.Hammer&&Hammer.NO_MOUSEEVENTS||_.each(c.EVENTS,function(d){c.addEvent(a.el,d,function(c){if("mousemove"==c.type){if(1>b)return b++,void 0;b=0}a.__mouseHandler(c)})}),window.Hammer&&Hammer.HAS_TOUCHEVENTS){var d=a.el[0];a._hammer=Hammer(d).on(Hammer.EventsTypes,function(c){if("drag"==c.type){if(1>b)return b++,void 0;b=0}"touch"==c.type&&(a.rootOffset=a.el.offset()),a.__touchHandler(c)})}},__touchHandler:function(a){var b=this;if(this._hammer.options.prevent_default=this.preventDefault?!0:!1,b.curPoints=b.__getCanvaxPointInTouchs(a),"release"==a.type)b.__dispatchEventInChilds(a,b.curPointsTarget)||b.__dispatchEventInChilds(a,[b]);else{"dragstart"==a.type&&_.each(b.curPointsTarget,function(a,c){return a&&a.dragEnabled?(b._draging=!0,b._clone2hoverStage(a,c),a.context.visible=!1,!1):void 0}),"drag"==a.type&&b._draging&&_.each(b.curPointsTarget,function(c,d){c&&c.dragEnabled&&b._dragHander(a,c,d)}),"dragend"==a.type&&b._draging&&(_.each(b.curPointsTarget,function(c){c&&c.dragEnabled&&(b._dragEnd(a,c,0),c.context.visible=!0)}),b._draging=!1);var c=b.__getChildInTouchs(b.curPoints);b.__dispatchEventInChilds(a,c)?"touch"==a.type&&(b.curPointsTarget=c):b.__dispatchEventInChilds(a,[b])}},__dispatchEventInChilds:function(a,d){if(!(d||"length"in d))return!1;var e=this,f=!1;return _.each(d,function(d,g){if(d){f=!0;var h=b.copyEvent(new c,a);h.target=h.currentTarget=d||this,h.stagePoint=e.curPoints[g],h.point=h.target.globalToLocal(h.stagePoint),d.dispatchEvent(h)}}),f},__getCanvaxPointInTouchs:function(a){var b=this,c=[];return _.each(a.gesture.touches,function(a){a.x=a.pageX-b.rootOffset.left,a.y=a.pageY-b.rootOffset.top,c.push(a)}),c},__getChildInTouchs:function(a){var b=this,c=[];return _.each(a,function(a){c.push(b.getObjectsUnderPoint(a,1)[0])}),c},__mouseHandler:function(a){var b=this;b.curPoints=[new h(a.pageX-b.rootOffset.left,a.pageY-b.rootOffset.top)];var d=b.curPoints[0],e=b.curPointsTarget[0];if("mousedown"==a.type){if(!e){var f=b.getObjectsUnderPoint(d,1)[0];f&&(b.curPointsTarget=[f])}e=b.curPointsTarget[0],e&&b.dragEnabled&&(b._touching=!0)}if(("mouseup"==a.type||"mouseout"==a.type)&&(1==b._draging&&b._dragEnd(a,e,0),b._draging=!1,b._touching=!1),"mouseout"==a.type&&b.__getcurPointsTarget(a,d),"mousemove"==a.type)b._touching&&"mousemove"==a.type&&e?(b._draging?b._dragHander(a,e,0):(e.dragBegin&&e.dragBegin(a),e.context.visible=!1,b._clone2hoverStage(e,0)),b._draging=!0):b.__getcurPointsTarget(a,d);else{var g=e;g||(g=b),b.__dispatchEventInChilds(a,[g])}this.preventDefault&&c.stopDefault(a)},__getcurPointsTarget:function(a,d){var e=this.curPointsTarget[0];if("mousemove"==a.type&&e&&e.getChildInPoint(d))return a.target=a.currentTarget=e,a.point=e.globalToLocal(d),this._mouseEventDispatch(e,a),void 0;var f=this.getObjectsUnderPoint(d,1)[0],a=b.copyEvent(new c,a);if(a.target=a.currentTarget=f,a.point=d,this._cursorHander(f,e),e&&e!=f||"mouseout"==a.type){if(!e)return;this.curPointsTarget[0]=null,a.type="mouseout",a.target=a.currentTarget=e,e.context.visible||(e.context.visible=!0),this._mouseEventDispatch(e,a)}f&&e!=f&&(this.curPointsTarget[0]=f,a.type="mouseover",a.target=a.currentTarget=f,this._mouseEventDispatch(f,a))},_mouseEventDispatch:function(a,b){a.dispatchEvent(b)},_clone2hoverStage:function(a,b){var c=this,d=c._hoverStage.getChildById(a.id);d||(d=a.clone(!0),d._transform=a.getConcatenatedMatrix(),c._hoverStage.addChild(d)),d.context.visible=!0,d._dragPoint=a.globalToLocal(c.curPoints[b])},_dragHander:function(a,b,c){var d=this,e=d._hoverStage.getChildById(b.id),f=new h(d.curPoints[c].x-e._dragPoint.x,d.curPoints[c].y-e._dragPoint.y);e.context.x=f.x,e.context.y=f.y,b.drag&&b.drag(a);var g=f;"stage"!=b.type&&b.parent&&"stage"!=b.parent.type&&(g=b.parent.globalToLocal(f)),b._notWatch=!0,b.context.x=g.x,b.context.y=g.y,b._notWatch=!1},_dragEnd:function(a,b){var c=this;c.dragEnd&&c.dragEnd(a);var d=c._hoverStage.getChildById(b.id);b.context.visible=!1,("mouseout"==a.type||"dragend"==a.type)&&d.destroy()},_cursorHander:function(a,b){a||b||this.setCursor("default"),a&&b!=a&&this.setCursor(a.context.cursor)},setCursor:function(a){this._cursor!=a&&(this.el.css("cursor",a),this._cursor=a)},setFrameRate:function(a){b.mainFrameRate!=a&&(b.mainFrameRate=a,this._speedTime=parseInt(1e3/b.mainFrameRate))},getFrameRate:function(){return b.mainFrameRate},__startEnter:function(){var a=this;a.requestAid||(a.requestAid=requestAnimationFrame(_.bind(a.__enterFrame,a)))},__enterFrame:function(){var a=this;if(a.requestAid=null,b.now=(new Date).getTime(),a._heartBeat){if(b.now-a._preRenderTime<a._speedTime)return a.__startEnter(),void 0;a.fire("beginRender"),_.each(_.values(a.convertStages),function(a){a.stage._render(a.stage.context2D)}),a._heartBeat=!1,a.convertStages={},a._preRenderTime=(new Date).getTime(),a.fire("afterRender")}if(a._taskList.length>0)for(var c=0,d=a._taskList.length;d>c;c++){var e=a._taskList[c];e.__enterFrame?e.__enterFrame():a.__taskList.splice(c--,1)}a._taskList.length>0&&a.__startEnter()},_afterAddChild:function(a,c){var d,e=!0;a.context2D?d=a.context2D.canvas:(e=!1,d=b._createCanvas(a.id,this.context.width,this.context.height)),1==this.children.length?this.el.append(d):this.children.length>1&&(void 0==c?this.el[0].insertBefore(d,this._hoverStage.context2D.canvas):c>=this.children.length-1?this.el.append(d):this.el[0].insertBefore(d,this.children[c].context2D.canvas)),e||b.initElement(d),a.initStage(d.getContext("2d"),this.context.width,this.context.height)},_afterDelChild:function(a){this.el[0].removeChild(a.context2D.canvas)},heartBeat:function(a){var b=this;if("context"==a.convertType){{var c=a.stage,d=a.shape;a.name,a.value,a.preValue}if(!b._isReady)return;if(b.convertStages[c.id]||(b.convertStages[c.id]={stage:c,convertShapes:{}}),d){if(b.convertStages[c.id].convertShapes[d.id])return;b.convertStages[c.id].convertShapes[d.id]={shape:d,convertType:null}}}if("children"==a.convertType){var e=a.target,c=a.src.getStage();(c||"stage"==e.type)&&(c=c||e,b.convertStages[c.id]||(b.convertStages[c.id]={stage:c,convertShapes:{}}))}if(!a.convertType){var c=a.stage;b.convertStages[c.id]||(b.convertStages[c.id]={stage:c,convertShapes:{}})}b._heartBeat?b._heartBeat=!0:(b._heartBeat=!0,b.__startEnter())}}),l.Display={Stage:e,Sprite:f,Shape:g,Point:h,Bitmap:i,Text:j,Movieclip:k},l},{requires:["canvax/core/Base","canvax/event/CanvaxEvent","canvax/display/DisplayObjectContainer","canvax/display/Stage","canvax/display/Sprite","canvax/display/Shape","canvax/display/Point","canvax/display/Bitmap","canvax/display/Text","canvax/display/Movieclip"]});